import{R as L,r as h,g as N,j as t,_ as A,aj as x,aB as p,F as R,a as y,K as $,B as b,aC as V,au as U,bb as q,M as z,u as _,i as H,aR as B,bc as K}from"./index.923808e7.js";import{U as Z}from"./index.6de58f7a.js";import{C as T}from"./index.d8bb5055.js";import{T as G,P as J}from"./index.3f13cb7e.js";import{c as W,a as Q,b as X,i as Y,d as ee,e as te,f as re,g as ae,h as ie}from"./index.13a982f3.js";import{i as ne,C as oe,D as se}from"./use-immer.module.d057e28e.js";import{M as le}from"./index.93d31941.js";import{c as D}from"./convertNullToUndefined.a19d8223.js";import{I as ce}from"./image.19b0aab9.js";import{I as ue}from"./index.2e4fbc7b.js";import"./index.dd4f8297.js";import"./index.58d9c8bd.js";import"./index.3cd647fa.js";import"./index.75ffc5fb.js";function S(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function j(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?S(Object(i),!0).forEach(function(n){A(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function de(r,e){var i=h.exports.useContext(N),n=i.prefixCls,s=n===void 0?"arco":n,m=r.spin,f=r.className,l=j(j({"aria-hidden":!0,focusable:!1,ref:e},r),{},{className:"".concat(f?f+" ":"").concat(s,"-icon ").concat(s,"-icon-reply")});return m&&(l.className="".concat(l.className," ").concat(s,"-icon-loading")),delete l.spin,delete l.isIcon,t("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...l,children:t("path",{d:"m6.642 24.684 14.012 14.947a.2.2 0 0 0 .346-.137v-8.949A23.077 23.077 0 0 1 26 30c6.208 0 11.84 2.459 15.978 6.456a.01.01 0 0 0 .017-.007C42 36.299 42 36.15 42 36c0-10.493-8.506-19-19-19-.675 0-1.342.035-2 .104V8.506a.2.2 0 0 0-.346-.137L6.642 23.316a1 1 0 0 0 0 1.368Z"})})}var F=L.forwardRef(de);F.defaultProps={isIcon:!0};F.displayName="IconReply";var pe=F;function P(r,e){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),i.push.apply(i,n)}return i}function k(r){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?P(Object(i),!0).forEach(function(n){A(r,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):P(Object(i)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(i,n))})}return r}function me(r,e){var i=h.exports.useContext(N),n=i.prefixCls,s=n===void 0?"arco":n,m=r.spin,f=r.className,l=k(k({"aria-hidden":!0,focusable:!1,ref:e},r),{},{className:"".concat(f?f+" ":"").concat(s,"-icon ").concat(s,"-icon-send")});return m&&(l.className="".concat(l.className," ").concat(s,"-icon-loading")),delete l.spin,delete l.isIcon,t("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...l,children:t("path",{strokeMiterlimit:"3.864",d:"m14 24-7-5V7l34 17L7 41V29l7-5Zm0 0h25"})})}var E=L.forwardRef(me);E.defaultProps={isIcon:!0};E.displayName="IconSend";var fe=E;const I=x.TextArea;function he(r){const[e]=p.useForm(),[i,n]=h.exports.useState(""),[s,m]=h.exports.useState(!1),[f,l]=h.exports.useState([]);async function w(){try{const a=await W();if(a.code===0){const o=a.data,u=new Map,g=[];o.forEach(C=>u.set(C.id,{...C,children:[]})),o.forEach(C=>{const d=u.get(C.pid);d?d.children.push(u.get(C.id)):g.push(u.get(C.id))}),l(g)}}catch{}}function O(a){n(a)}async function c(){e.validate().then(async a=>{const o=D(a);try{if(!i||i==="<p><br></p>")throw z.error("\u8BF7\u586B\u5199\u6587\u7AE0\u5185\u5BB9"),new Error("\u8BF7\u586B\u5199\u6587\u7AE0\u5185\u5BB9");const u={...o,cover_image:o.cover_image&&o.cover_image.length!==0?o.cover_image[0].response.data.name:void 0,is_published:o.is_published?"true":"false",content:i,sort_index:o.sort_index||1};let g;r.data?g=await Q({...u,uuid:r.data.uuid}):g=await X(u),g.code===0&&(r.reload(),r.close())}finally{m(!1)}}).catch(a=>{console.log(a),console.error("\u4FE1\u606F\u4E0D\u5B8C\u6574")})}return h.exports.useEffect(()=>{w()},[]),h.exports.useEffect(()=>{if(r.data){const a=D(r.data);let o="";o=a.cover_image,e.setFieldsValue({...a,status:a.is_published===1,cover_image:a.cover_image?[{uid:a.cover_image,url:o,response:{data:{name:a.cover_image.replace("/media/image?n=",""),path:a.cover_image}}}]:[]}),n(a.content)}},[r.data]),h.exports.useEffect(()=>{r.visible===!1&&(e.resetFields(),n(void 0))},[e,r.visible]),t(R,{children:y(T,{title:r.data?"\u4FEE\u6539\u6587\u7AE0":"\u521B\u5EFA\u6587\u7AE0",extra:t($,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>r.close()}),actions:[t(b,{type:"default",onClick:()=>r.close(),children:"\u53D6\u6D88"},"cancel"),t(b,{type:"primary",loading:s,onClick:c,children:r.data?"\u4FDD\u5B58":"\u521B\u5EFA"},"submit")],children:[y(p,{form:e,labelCol:{span:2},wrapperCol:{span:22},children:[t(p.Item,{label:"\u6807\u9898",field:"title",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898"}],children:t(x,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u6807\u9898"})}),t(p.Item,{label:"\u5206\u7C7B",field:"cid",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7C7B"}],wrapperCol:{span:2},children:t(G,{treeData:f,fieldNames:{key:"id",title:"name"},allowClear:!0})}),t(p.Item,{label:"\u6587\u7AE0\u5C01\u9762",field:"cover_image",triggerPropName:"fileList",children:t(Z,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),t(p.Item,{label:"\u4F5C\u8005",field:"author",wrapperCol:{span:2},children:t(x,{maxLength:50,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u4F5C\u8005"})}),t(p.Item,{label:"SEO\u6807\u9898",field:"seo_title",children:t(x,{maxLength:200,showWordLimit:!0,placeholder:"SEO\u6807\u9898"})}),t(p.Item,{label:"SEO\u63CF\u8FF0",field:"seo_desc",children:t(I,{maxLength:200,placeholder:"SEO\u63CF\u8FF0",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),t(p.Item,{label:"SEO\u5173\u952E\u8BCD",field:"seo_keywords",children:t(I,{maxLength:200,placeholder:"SEO\u5173\u952E\u8BCD",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),t(p.Item,{label:"\u63CF\u8FF0",field:"summary",children:t(I,{maxLength:200,placeholder:"\u8BF7\u8F93\u5165\u63CF\u8FF0",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),t(p.Item,{label:"\u6392\u5E8F",field:"sort_index",wrapperCol:{span:2},initialValue:1,rules:[{validator(a,o){a&&a<1?o("\u6392\u5E8F\u5FC5\u987B\u5927\u4E8E0"):o()}}],children:t(V,{maxLength:10,hideControl:!0,placeholder:"\u6587\u7AE0\u6392\u5E8F"})}),t(p.Item,{label:"\u662F\u5426\u53D1\u5E03",field:"is_published",triggerPropName:"checked",initialValue:!1,children:t(U,{})})]}),t(q,{orientation:"left",children:"\u6B63\u6587"}),t(le,{html:i,getContent:O})]})})}function Se(){const r=_(H),e=_(Y),i=h.exports.useRef(),[n,s]=h.exports.useState([]),[m,f]=ne({visible:!1,close:function(){f(c=>{c.visible=!1})}});async function l(c){const o=(await W()).data,u=new Map,g=[];return o.forEach(d=>u.set(d.id,{...d,children:[]})),o.forEach(d=>{const v=u.get(d.pid);v?v.children.push(u.get(d.id)):g.push(u.get(d.id))}),s(g),c.map(d=>{const v=o.find(M=>M.id===d.cid);return{...d,category:v?v.name:null}})}async function w(c){try{const a=await ie({uuid:c});a.code===0&&f(o=>{o.data=a.data,o.visible=!0})}catch{}}const O=[{title:e["columns.category"],dataIndex:"cid",search:!0,hide:!0,valueType:"treeSelect",fieldProps:{treeData:n,fieldNames:{key:"id",title:"name"},allowClear:!0}},{title:e["columns.keyword"],dataIndex:"keyword",search:!0,hide:!0},{title:"ID",dataIndex:"id"},{title:e["columns.title"],dataIndex:"title",ellipsis:!0},{title:e["columns.category"],dataIndex:"category"},{title:e["columns.author"],dataIndex:"author"},{title:e["columns.coverImage"],width:150,dataIndex:"cover_image",render:(c,a)=>{if(a.cover_image){let o="";return o=a.cover_image,t(ce,{width:40,height:40,src:o})}else return e.notCover}},{title:e["columns.views"],dataIndex:"view_count"},{title:e["columns.publishStatus"],dataIndex:"is_published",render(c,a){return a.is_published===1?t(B,{color:"green",children:e["columns.publishStatus.published"]}):t(B,{color:"red",children:e["columns.publishStatus.unPublished"]})}},{title:e["columns.publishedAt"],width:200,dataIndex:"published_at"},{title:e["columns.action"],width:280,render:(c,a)=>y(oe,{children:[y(b,{type:"text",onClick:()=>w(a.uuid),children:[t(K,{}),e["columns.action.edit"]]}),a.is_published===0?y(b,{type:"text",onClick:async()=>{(await ee(a.uuid)).code===0&&i.current.reload()},children:[t(fe,{}),e["columns.action.publish"]]}):y(b,{type:"text",onClick:async()=>{(await te(a.uuid)).code===0&&i.current.reload()},children:[t(pe,{}),e["columns.action.unPublish"]]}),t(se,{reqDel:re,params:{uuid:a.uuid},reload:()=>i.current.reload(),children:y(b,{type:"text",children:[t(ue,{}),e["columns.action.delete"]]})})]})}];return y(R,{children:[m.visible&&t(he,{visible:m.visible,data:m.data,close:()=>m.close(),reload:()=>i.current.reload()}),t(T,{style:{display:m.visible?"none":void 0},children:t(J,{ref:i,request:ae,columns:O,dataRender:l,actionBarRender:[t(b,{type:"primary",onClick:()=>i.current.reload(),children:r["table.refresh"]},"refresh")],toolBarRender:[t(b,{type:"primary",onClick:()=>{f(c=>{c.visible=!0,c.data=void 0})},children:r["table.createArticle"]},"create")]})})]})}export{Se as default};
