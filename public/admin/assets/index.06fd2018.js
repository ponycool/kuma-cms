import{h as p,u as P,av as s,r,j as t,bd as R,a as g,af as h,aj as T,aw as W,am as D,bl as x,i as $,B as y,bc as z,l as J,bm as G,be as H}from"./index.1f4442a4.js";import{C as K}from"./index.299756e8.js";import{P as Q}from"./index.22b56d0d.js";import{C as X}from"./index.3c134d6b.js";import"./index.837507d1.js";import{U as Y}from"./index.209484fd.js";import{t as Z}from"./index.ce7f7976.js";import{c as L}from"./convertNullToUndefined.a19d8223.js";import{q as ee}from"./index.ff7b0f57.js";import{i as ae}from"./use-immer.module.b9538e95.js";import{I as ue}from"./index.a2f913f5.js";import"./index.4ce8cb13.js";import"./b-tween.es.064e2a03.js";import"./index.4d38a18b.js";import"./index.4f6f0621.js";import"./index.9fd0cefa.js";import"./index.9630c4d6.js";import"./index.359a0f75.js";import"./index.b38fa1a3.js";import"./index.ace897e6.js";function S(u){return p.post("/api/menu/query",u)}function M(u){return p.post("/api/menu/update",{menu:JSON.stringify(u)})}function te(u){return p.post("/api/menu/enable",u)}function le(u){return p.post("/api/menu/disable",u)}function U(){return p.post("/api/menu/type/query")}function ie(){return p.post("/api/link/type/query")}function ne(){return p.post("/api/module/query")}function re(u){return p.post("/api/menu/visible",u)}function se(u){return p.post("/api/menu/hidden",u)}const w={"en-US":{create:"Create",update:"Update",cancel:"Cancel",save:"Save",parentMenu:"Parent Menu","parentMenu.placeholder":"Please enter a parent Menu",name:"Menu Name","name.placeholder":"Please enter a menu name","name.required":"Please enter a menu name",code:"Menu Code","code.placeholder":"Please enter a menu code","code.required":"Please enter a menu code",icon:"Menu Icon",menuType:"Menu Type","menuType.placeholder":"Please select a menu type","menuType.required":"Please select a menu type",linkType:"Link Type","linkType.placeholder":"Please select a link type","linkType.required":"Please select a link type",linkUrl:"Link URL","linkUrl.placeholder":"Please enter a link URL","linkUrl.required":"Please enter a link URL",singlePage:"Single Page","singlePage.placeholder":"Please select a single page","singlePage.required":"Please select a single page",module:"Module","module.placeholder":"Please select a module","module.required":"Please select a module",target:"Target","target.placeholder":"Please select a target","target.required":"Please select a target",sortIndex:"Sort Index",isVisible:"Is Visible",isEnable:"Is Enable",action:"Action",edit:"Edit",visible:"Visible",hidden:"Hidden",enable:"Enable",disable:"Disable"},"zh-CN":{create:"\u521B\u5EFA",update:"\u66F4\u65B0",cancel:"\u53D6\u6D88",save:"\u4FDD\u5B58",parentMenu:"\u7236\u7EA7\u83DC\u5355","parentMenu.placeholder":"\u8BF7\u8F93\u5165\u7236\u7EA7\u83DC\u5355",name:"\u540D\u79F0","name.required":"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0","name.placeholder":"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0",code:"\u83DC\u5355\u7F16\u7801","code.required":"\u8BF7\u8F93\u5165\u83DC\u5355\u7F16\u7801","code.placeholder":"\u8BF7\u8F93\u5165\u83DC\u5355\u7F16\u7801",icon:"\u83DC\u5355\u56FE\u6807",menuType:"\u83DC\u5355\u7C7B\u578B","menuType.placeholder":"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B","menuType.required":"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B",linkType:"\u94FE\u63A5\u7C7B\u578B","linkType.placeholder":"\u8BF7\u9009\u62E9\u94FE\u63A5\u7C7B\u578B","linkType.required":"\u8BF7\u9009\u62E9\u94FE\u63A5\u7C7B\u578B",linkUrl:"\u94FE\u63A5\u5730\u5740","linkUrl.placeholder":"\u8BF7\u8F93\u5165\u94FE\u63A5\u5730\u5740","linkUrl.required":"\u8BF7\u8F93\u5165\u94FE\u63A5\u5730\u5740",singlePage:"\u5355\u9875","singlePage.placeholder":"\u8BF7\u9009\u62E9\u5355\u9875","singlePage.required":"\u8BF7\u9009\u62E9\u5355\u9875",module:"\u6A21\u5757","module.placeholder":"\u8BF7\u9009\u62E9\u6A21\u5757","module.required":"\u8BF7\u9009\u62E9\u6A21\u5757",target:"\u8DF3\u8F6C\u65B9\u5F0F","target.placeholder":"\u8BF7\u9009\u62E9\u8DF3\u8F6C\u65B9\u5F0F","target.required":"\u8BF7\u9009\u62E9\u8DF3\u8F6C\u65B9\u5F0F",sortIndex:"\u6392\u5E8F",isVisible:"\u662F\u5426\u53EF\u89C1",isEnable:"\u542F\u7528",action:"\u64CD\u4F5C",edit:"\u7F16\u8F91",visible:"\u663E\u793A",hidden:"\u9690\u85CF",enable:"\u542F\u7528",disable:"\u7981\u7528"}};function oe(u){const e=P(w),[d]=s.useForm(),[F,k]=r.exports.useState(!1),[b,f]=r.exports.useState([]),[q,C]=r.exports.useState([]),[i,n]=r.exports.useState([]),[l,m]=r.exports.useState(""),[A,O]=r.exports.useState([]),[N,j]=r.exports.useState([]),[I,V]=r.exports.useState([]);async function _(){d.validate().then(async a=>{const o=L({...a,level:Number(a.pid)+1,icon:a.icon&&a.icon.length!==0?a.icon[0].response.data.name:void 0});try{let c;const B=u==null?void 0:u.getList();if(console.log(B),u.data){const E=B.map(v=>v.id===u.data.id?x({...v,...u==null?void 0:u.data,...o}):x({...v}));c=await M(E)}else c=await M([...B,{...u==null?void 0:u.data,...o}].map(E=>x({...E})));c.code===0&&(u.reload(),u.close())}finally{k(!1)}}).catch(a=>{console.log(a),console.error("\u4FE1\u606F\u4E0D\u5B8C\u6574")})}return r.exports.useEffect(()=>{if(u.data){const a=L(u.data),o=a.icon;d.setFieldsValue({...a,icon:a.icon?[{uid:a.icon,url:o,response:{data:{name:a.icon.replace("/media/image?n=",""),path:a.icon}}}]:[],visible:!!a.visible,enabled:!!a.enabled}),m(a.type)}},[u.data]),r.exports.useEffect(()=>{u.visible===!1&&d.resetFields(),u.visible&&S({}).then(a=>{V(a.data||[])})},[d,u.visible]),r.exports.useEffect(()=>{U().then(a=>{const o=[];Object.keys(a.data).forEach(c=>{o.push({value:c,label:a.data[c]})}),f(o)}),Z().then(a=>{const o=[];Object.keys(a.data).forEach(c=>{o.push({value:c,label:a.data[c]})}),C(o)}),ie().then(a=>{const o=[];Object.keys(a.data).forEach(c=>{o.push({value:a.data[c],label:c})}),n(o)}),ee({isPage:!1}).then(a=>{O(a.data)}),ne().then(a=>{j(a.data)})},[]),t(R,{width:600,title:u.data?e.update:e.create,visible:u.visible,onOk:_,onCancel:u.close,confirmLoading:F,okText:u.data?e.save:e.create,children:g(s,{form:d,labelCol:{span:6},wrapperCol:{span:18},onChange:a=>{console.log(a)},children:[t(s.Item,{label:e.parentMenu,field:"pid",rules:[{required:!0,message:e["parentMenu.required"]}],children:t(h,{options:I&&[{name:"\u6839\u7EA7\u522B",id:0},...I].map(a=>({label:a.name,value:a.id})),placeholder:e["parentMenu.placeholder"]})}),t(s.Item,{label:e.name,field:"name",rules:[{required:!0,message:e["name.required"]}],children:t(T,{maxLength:100,showWordLimit:!0,placeholder:e["name.placeholder"]})}),t(s.Item,{label:e.code,field:"code",rules:[{required:!0,message:e["code.required"]}],children:t(T,{maxLength:20,showWordLimit:!0,placeholder:e["code.placeholder"]})}),t(s.Item,{label:e.icon,field:"icon",triggerPropName:"fileList",children:t(Y,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),t(s.Item,{label:e.menuType,field:"type",rules:[{required:!0,message:e["menuType.required"]}],children:t(h,{options:b,placeholder:e["menuType.placeholder"],onChange:m})}),l==="link"&&t(s.Item,{label:e.linkType,field:"link_type",rules:[{required:!0,message:e["linkType.required"]}],children:t(h,{options:i})}),l==="link"&&t(s.Item,{label:e.linkUrl,field:"link_url",rules:[{required:!0,message:e["linkUrl.required"]}],children:t(T,{maxLength:100,showWordLimit:!0,placeholder:e["linkUrl.placeholder"]})}),l==="single_page"&&t(s.Item,{label:e.singlePage,field:"single_page_id",rules:[{required:!0,message:e["singlePage.required"]}],children:t(h,{options:A.map(a=>({label:a.title,value:a.id})),placeholder:e["singlePage.placeholder"]})}),l==="module"&&t(s.Item,{label:e.module,field:"module_id",rules:[{required:!0,message:e["module.required"]}],children:t(h,{options:N.map(a=>({label:a.text,value:a.code})),placeholder:e["module.placeholder"]})}),t(s.Item,{label:e.target,field:"target",rules:[{required:!0,message:e["target.required"]}],children:t(h,{options:q,placeholder:e["target.placeholder"]})}),t(s.Item,{label:e.sortIndex,field:"sort_index",initialValue:0,children:t(W,{})}),t(s.Item,{label:e.isVisible,field:"visible",triggerPropName:"checked",initialValue:!1,children:t(D,{})}),t(s.Item,{label:e.isEnable,field:"enabled",triggerPropName:"checked",initialValue:!1,children:t(D,{})})]})})}function De(){var C;const u=P($),e=P(w),d=r.exports.useRef(),[F,k]=r.exports.useState();r.exports.useState(),r.exports.useState();const[b,f]=ae({visible:!1,close:()=>{f(i=>{i.visible=!1,i.data=void 0})}}),q=[{title:"ID",dataIndex:"id"},{title:e.name,dataIndex:"name"},{title:e.code,dataIndex:"code"},{title:e.menuType,render(i,n){return F&&F[n.type]}},{title:e.icon,render(i,n){return t("img",{src:n.icon,alt:""})}},{title:e.action,key:"option",render:(i,n)=>g(X,{children:[g(y,{type:"text",onClick:()=>{f(l=>{l.visible=!0,l.data=n})},children:[t(z,{}),e.edit]}),g(y,{type:"text",onClick:async()=>{var m;let l;n.visible?l=await(l=se({uuid:n.uuid})):l=await(l=re({uuid:n.uuid})),l.code===0&&((m=d.current)==null||m.reload())},children:[n.visible?t(J,{}):t(G,{}),n.visible?e.visible:e.hidden]}),g(y,{type:"text",onClick:async()=>{var m;let l;n.enabled?l=l=await le({uuid:n.uuid}):l=l=await te({uuid:n.uuid}),l.code===0&&((m=d.current)==null||m.reload())},children:[n.enabled?t(H,{}):t(ue,{}),n.enabled?e.enable:e.disable]})]})}];return r.exports.useEffect(()=>{U().then(i=>{k(i.data)})},[]),g(K,{children:[t(oe,{data:b.data,visible:b.visible,close:b.close,reload:()=>{var i;return(i=d.current)==null?void 0:i.reload()},getList:(C=d.current)==null?void 0:C.getList}),t(Q,{ref:d,request:S,columns:q,pagination:!1,pageSize:!1,actionBarRender:[t(y,{type:"primary",onClick:()=>{var i;return(i=d.current)==null?void 0:i.reload()},children:u["table.refresh"]},"refresh")],toolBarRender:[t(y,{type:"primary",onClick:()=>{f(i=>{i.visible=!0})},children:u["table.create"]},"create")]})]})}export{De as default};
