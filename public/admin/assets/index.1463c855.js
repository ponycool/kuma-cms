import{aj as k,u as L,r as p,bj as j,av as d,a as h,j as t,K as O,B as g,aw as _,am as F,be as M,M as z,i as B,aR as D,bg as R,F as J}from"./index.8958ccd3.js";import{U as P,I as U}from"./index.63a6e7c8.js";import{C as N}from"./index.5b407dd2.js";import{T as V,P as W}from"./index.b1730033.js";import{i as q,d as E,u as A,e as K,f as G,g as H,r as Q,p as $,h as X}from"./index.eb4696cf.js";import{C as Y,D as Z}from"./DelPopconfirm.59a62120.js";import"./index.8139da41.js";import{M as ee}from"./index.78b4538c.js";import{c as S}from"./convertNullToUndefined.a19d8223.js";import{i as te}from"./use-immer.module.9e5b55d6.js";import{I as ae}from"./image.ec38ca4f.js";import{I as re}from"./index.c0c65699.js";import{I as oe}from"./index.ee4272bb.js";import"./index.2f42bc35.js";import"./index.19f2ec66.js";import"./index.9e72e6f1.js";import"./index.c8cf1267.js";import"./b-tween.es.064e2a03.js";import"./index.9ebfb29d.js";import"./index.8afc8c0f.js";import"./index.0361d86b.js";const T=k.TextArea;function ie(i){const e=L(q),{lang:m}=p.exports.useContext(j),[C]=d.useForm(),[y,f]=p.exports.useState(""),[b,x]=p.exports.useState(!1),[v,w]=p.exports.useState([]);async function c(){try{const a=await E();if(a.code===0){const r=a.data,u=new Map,o=[];r.forEach(s=>u.set(s.id,{...s,children:[]})),r.forEach(s=>{const I=u.get(s.pid);I?I.children.push(u.get(s.id)):o.push(u.get(s.id))}),w(o)}}catch{}}function l(a){f(a)}async function n(){C.validate().then(async a=>{x(!0);const r=S(a);try{if(!y||y==="<p><br></p>")throw z.error(e["productCreate.form.description.required"]),new Error(e["productCreate.form.description.required"]);const u={...r,cover_image:r.cover_image&&r.cover_image.length!==0?r.cover_image[0].response.data.name:void 0,detail_images:r.detail_images&&r.detail_images.length!==0?JSON.stringify(r.detail_images.map(s=>s.response.data.name)):void 0,status:r.status?"true":"false",description:y,stock_quantity:r.stock_quantity||0,price:r.price||0,sort_index:r.sort_index||1};let o;i.data?o=await A({...u,uuid:i.data.uuid}):o=await K(u),o.code===0&&(i.reload(),i.close())}finally{x(!1)}}).catch(()=>{console.error(e["productCreate.form.description.error"])})}return p.exports.useEffect(()=>{c()},[]),p.exports.useEffect(()=>{if(i.data){const a=S(i.data),r=a.cover_image;C.setFieldsValue({...a,status:a.status===1,cover_image:a.cover_image?[{uid:a.cover_image,url:r,response:{data:{name:a.cover_image.replace("/media/image?n=",""),path:a.cover_image}}}]:[],detail_images:a.detail_images?JSON.parse(a.detail_images).map((u,o)=>({uid:o,url:u,response:{data:{name:u.replace("/media/image?n=",""),path:u}}})):[]}),f(i.data.description)}},[i.data]),p.exports.useEffect(()=>{i.visible===!1&&C.resetFields()},[C,i.visible]),h(N,{title:i.data?e["productCreate.title.update"]:e["productCreate.title.create"],extra:t(O,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>i.close()}),actions:[t(g,{type:"default",onClick:()=>i.close(),children:e["productCreate.button.cancel"]},"cancel"),t(g,{type:"primary",loading:b,onClick:n,children:i.data?e["productCreate.button.save"]:e["productCreate.button.create"]},"submit")],children:[h(d,{form:C,labelCol:{span:m==="zh-CN"?2:3},wrapperCol:{span:m==="zh-CN"?22:21},children:[t(d.Item,{label:e["productCreate.form.name.label"],field:"name",rules:[{required:!0,message:e["productCreate.form.name.required"]}],children:t(k,{maxLength:100,showWordLimit:!0,placeholder:e["productCreate.form.name.placeholder"]})}),t(d.Item,{label:e["productCreate.form.category.label"],field:"cid",rules:[{required:!0,message:e["productCreate.form.category.required"]}],wrapperCol:{span:2},children:t(V,{treeData:v,fieldNames:{key:"id",title:"name"},allowClear:!0,placeholder:e["productCreate.form.category.placeholder"]})}),t(d.Item,{label:e["productCreate.form.coverImage.label"],field:"cover_image",triggerPropName:"fileList",children:t(P,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),t(d.Item,{label:e["productCreate.form.detailImage.label"],field:"detail_images",triggerPropName:"fileList",children:t(P,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card"})}),t(d.Item,{label:e["productCreate.form.seoTitle.label"],field:"seo_title",children:t(k,{maxLength:200,showWordLimit:!0,placeholder:e["productCreate.form.seoTitle.placeholder"]})}),t(d.Item,{label:e["productCreate.form.seoDesc.label"],field:"seo_desc",children:t(T,{maxLength:200,placeholder:e["productCreate.form.seoDesc.placeholder"],showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),t(d.Item,{label:e["productCreate.form.seoKeywords.label"],field:"seo_keywords",children:t(T,{maxLength:200,placeholder:e["productCreate.form.seoKeywords.placeholder"],showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),t(d.Item,{label:e["productCreate.form.price.label"],field:"price",wrapperCol:{span:2},initialValue:0,children:t(_,{maxLength:10,hideControl:!0,placeholder:e["productCreate.form.price.placeholder"],precision:2})}),t(d.Item,{label:e["productCreate.form.stock.label"],field:"stock_quantity",wrapperCol:{span:2},initialValue:0,children:t(_,{maxLength:10,hideControl:!0,precision:0,placeholder:e["productCreate.form.stock.placeholder"]})}),t(d.Item,{label:e["productCreate.form.sortIndex.label"],field:"sort_index",wrapperCol:{span:2},initialValue:1,rules:[{validator(a,r){a&&a<1?r(e["productCreate.form.sortIndex.error"]):r()}}],children:t(_,{maxLength:10,hideControl:!0,precision:0,placeholder:e["productCreate.form.sortIndex.placeholder"]})}),t(d.Item,{label:e["productCreate.form.status.label"],field:"status",triggerPropName:"checked",children:t(F,{})})]}),t(M,{orientation:"left",children:e["productCreate.form.description.label"]}),t(ee,{html:y,getContent:l})]})}function De(){const i=L(B),e=L(q),m=p.exports.useRef(),[C,y]=p.exports.useState([]),[f,b]=te({visible:!1,close:function(){b(c=>{c.visible=!1})}});async function x(c){const n=(await E()).data,a=new Map,r=[];return n.forEach(o=>a.set(o.id,{...o,children:[]})),n.forEach(o=>{const s=a.get(o.pid);s?s.children.push(a.get(o.id)):r.push(a.get(o.id))}),y(r),c.map(o=>{const s=n.find(I=>I.id===o.cid);return{...o,category:s?s.name:null}})}async function v(c){try{const l=await X({uuid:c});l.code===0&&b(n=>{n.data=l.data,n.visible=!0})}catch{}}const w=[{title:e["columns.keyword"],dataIndex:"keyword",search:!0,hide:!0},{title:e["columns.category"],dataIndex:"cid",search:!0,hide:!0,valueType:"treeSelect",fieldProps:{treeData:C,fieldNames:{key:"id",title:"name"},allowClear:!0}},{title:"ID",dataIndex:"id"},{title:e["columns.title"],dataIndex:"name",ellipsis:!0},{title:e["columns.productImage"],width:150,dataIndex:"cover_image",render:(c,l)=>{if(l.cover_image){let n="";return n=l.cover_image,t(ae,{width:40,height:40,src:n})}else return e["columns.noCover"]}},{title:e["columns.category"],ellipsis:!0,dataIndex:"category"},{title:e["columns.price"],dataIndex:"price"},{title:e["columns.stockQuantity"],dataIndex:"stock_quantity"},{title:e["columns.views"],dataIndex:"view_count"},{title:e["columns.isPublished"],dataIndex:"is_published",render(c,l){return l.status===1?t(D,{color:"green",children:e["columns.isPublished.published"]}):t(D,{color:"red",children:e["columns.isPublish.unPublished"]})}},{title:e["columns.updateAt"],width:180,dataIndex:"updated_at"},{title:e["columns.action"],width:280,render:(c,l)=>h(Y,{children:[h(g,{type:"text",onClick:()=>v(l.uuid),children:[t(R,{}),e["columns.action.edit"]]}),l.status===0?h(g,{type:"text",onClick:async()=>{(await G(l.uuid)).code===0&&m.current.reload()},children:[t(U,{}),e["columns.action.publish"]]}):h(g,{type:"text",onClick:async()=>{(await H(l.uuid)).code===0&&m.current.reload()},children:[t(re,{}),e["columns.action.unPublish"]]}),t(Z,{reqDel:Q,params:{uuid:l.uuid},reload:()=>m.current.reload(),children:h(g,{type:"text",children:[t(oe,{}),e["columns.action.delete"]]})})]})}];return h(J,{children:[f.visible&&t(ie,{visible:f.visible,data:f.data,close:()=>f.close(),reload:()=>m.current.reload()}),t(N,{style:{display:f.visible?"none":void 0},children:t(W,{ref:m,request:$,columns:w,dataRender:x,actionBarRender:[t(g,{type:"primary",onClick:()=>m.current.reload(),children:i["table.refresh"]},"refresh")],toolBarRender:[t(g,{type:"primary",onClick:()=>{b(c=>{c.visible=!0,c.data=void 0})},children:i["table.createProduct"]},"create")]})})]})}export{De as default};
