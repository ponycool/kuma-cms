import{u as I,r as n,bf as y,av as i,j as e,K as D,B as g,a as c,aj as d,af as L,aw as N,am as P,bb as h}from"./index.a53dd88a.js";import{T as m}from"./index.b4303da9.js";import{U as C}from"./index.7625d65a.js";import{D as f}from"./index.aa916241.js";import"./index.c0b527ed.js";import{C as S}from"./index.706fd92e.js";import{l as j,u as k,c as F}from"./index.467e35af.js";import{c as b}from"./convertNullToUndefined.a19d8223.js";import{M as _}from"./index.3700b6dc.js";import"./index.612dfb75.js";import"./index.416e4a3c.js";import"./index.f63f9efd.js";import"./index.af9427c5.js";import"./index.2a971ca2.js";import"./b-tween.es.064e2a03.js";function G(l){const a=I(j),{lang:v}=n.exports.useContext(y),[o]=i.useForm(),[w,p]=n.exports.useState(!1);async function x(){o.validate().then(async t=>{p(!0);const r=b(t);try{const u={...r,cover_image:r.cover_image&&r.cover_image.length!==0?r.cover_image[0].response.data.name:void 0,poster_image:r.poster_image&&r.poster_image.length!==0?r.poster_image[0].response.data.name:void 0,is_active:r.is_active?"true":"false",sort_index:r.sort_index||1,status:r.status};let s;l.data?s=await k({...u,uuid:l.data.uuid}):s=await F(u),s.code===0&&(l.reload(),l.close())}finally{p(!1)}}).catch(t=>{console.error(t)})}return n.exports.useEffect(()=>{if(l.data){const t=b(l.data);let r="";r=t.cover_image,o.setFieldsValue({...t,status:t.status,cover_image:t.cover_image?[{uid:t.cover_image,url:r,response:{data:{name:t.cover_image.replace("/media/image?n=",""),path:t.cover_image}}}]:[],poster_image:t.poster_image?[{uid:t.poster_image,url:r,response:{data:{name:t.poster_image.replace("/media/image?n=",""),path:t.poster_image}}}]:[]})}},[l.data]),e(S,{title:a["cardCreate.title"],extra:e(D,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>l.close()}),actions:[e(g,{type:"default",onClick:()=>l.close(),children:a["cardCreate.button.cancel"]},"cancel"),e(g,{type:"primary",loading:w,onClick:x,children:l.data?a["cardCreate.button.save"]:a["cardCreate.button.create"]},"submit")],children:e(i,{form:o,labelCol:{span:2},wrapperCol:{span:22},children:c(m,{children:[c(m.TabPane,{title:"\u57FA\u672C\u4FE1\u606F",children:[e(i.Item,{label:a["cardCreate.label.title"],field:"name",rules:[{required:!0,message:a["cardCreate.message.titleRequired"]}],wrapperCol:{span:8},children:e(d,{maxLength:100,showWordLimit:!0,placeholder:a["cardCreate.placeholder.title"]})}),e(i.Item,{label:a["cardCreate.label.cover"],field:"cover_image",triggerPropName:"fileList",children:e(C,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),e(i.Item,{label:a["cardCreate.label.location"],field:"location",wrapperCol:{span:4},children:e(d,{maxLength:50,placeholder:a["cardCreate.placeholder.location"]})}),e(i.Item,{label:a["cardCreate.label.startDatetime"],field:"start_datetime",wrapperCol:{span:4},children:e(f,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}})}),e(i.Item,{label:a["cardCreate.label.endDatetime"],field:"end_datetime",wrapperCol:{span:4},children:e(f,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}})}),e(i.Item,{label:a["cardCreate.label.status"],field:"status",wrapperCol:{span:2},children:e(L,{options:Object.entries(l.status).map(([t,r])=>({label:v==="zh-CN"?r:t,value:t})),placeholder:a["cardCreate.placeholder.status"]})}),e(i.Item,{label:a["cardCreate.label.sortIndex"],field:"sort_index",wrapperCol:{span:1},rules:[{validator(t,r){t&&t<1?r(a["cardCreate.message.sortIndexRequired"]):r()}}],children:e(N,{maxLength:10,hideControl:!0,precision:0,placeholder:a["cardCreate.placeholder.sortIndex"]})}),e(i.Item,{label:a["cardCreate.label.activityStatus"],field:"is_active",wrapperCol:{span:2},triggerPropName:"checked",initialValue:!1,children:e(P,{})}),e(h,{orientation:"left",children:a["cardCreate.label.content"]}),e(i.Item,{field:"content",wrapperCol:{span:24},triggerPropName:"html",trigger:"getContent",rules:[{required:!0},{validator(t,r){if(t==="<p><br></p>")return r(a["cardCreate.message.contentRequired"]);r()}}],children:e(_,{})})]},"1"),c(m.TabPane,{title:"\u6D3B\u52A8\u4FE1\u606F",children:[e(i.Item,{label:a["cardCreate.label.posterImage"],field:"poster_image",triggerPropName:"fileList",children:e(C,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),e(i.Item,{label:a["cardCreate.label.posterSummary"],field:"summary",wrapperCol:{span:20},children:e(d,{maxLength:200,showWordLimit:!0,placeholder:a["cardCreate.placeholder.posterSummary"]})}),e(h,{orientation:"left",children:a["cardCreate.label.posterContent"]}),e(i.Item,{field:"poster_content",wrapperCol:{span:24},triggerPropName:"html",trigger:"getContent",children:e(_,{})})]},"2")]})})})}export{G as default};
