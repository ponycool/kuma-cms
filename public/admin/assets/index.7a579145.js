import{u as h,av as p,r as f,j as r,bd as w,a as C,aj as x,aw as F,M as k,i as q,B as g,bc as j}from"./index.1f4442a4.js";import{C as E}from"./index.299756e8.js";import{T as L,P as M}from"./index.22b56d0d.js";import{i as D,r as O,j as R,k as S,c as V}from"./index.51d67189.js";import{C as _}from"./index.3c134d6b.js";import{i as I}from"./use-immer.module.b9538e95.js";import{D as B}from"./DelPopconfirm.e814543a.js";import{I as T}from"./index.13288026.js";import{I as G}from"./index.ace897e6.js";import"./index.4ce8cb13.js";import"./b-tween.es.064e2a03.js";import"./index.4d38a18b.js";import"./index.4f6f0621.js";import"./index.9fd0cefa.js";function N(e){const t=h(D),[a]=p.useForm(),[n,c]=f.exports.useState(!1),[v,u]=f.exports.useState(1);f.exports.useEffect(()=>(e.level&&u(e.level+1),()=>{u(1)}),[e.level]),f.exports.useEffect(()=>{e.data?(a.setFieldsValue(e.data),a.setFieldValue("pid",e.data.pid)):e.id&&a.setFieldValue("pid",e.id),e.visible||a.resetFields()},[a,e.data,e.visible]);async function y(){a.validate().then(async l=>{var o;c(!0);let i;e.uuid?i=await O({...l,uuid:e.uuid,pid:l.pid,level:v,sortIndex:l.sortIndex||1}):i=await R({...l,pid:(o=l.pid)!=null?o:0,level:v,sortIndex:l.sortIndex||1}),i.code===0&&(k.success(i.message),e.reload(),e.close(),a.resetFields())}).catch(l=>{console.log(l)}).finally(()=>{c(!1)})}return r(w,{width:400,title:e.uuid?t["categoryCreate.title.update"]:t["categoryCreate.title.create"],visible:e.visible,onOk:y,onCancel:e.close,confirmLoading:n,okText:e.uuid?t["categoryCreate.button.save"]:t["categoryCreate.button.create"],children:C(p,{form:a,children:[r(p.Item,{label:t["categoryCreate.form.name.label"],field:"name",rules:[{required:!0,message:!0}],labelCol:{span:6},wrapperCol:{span:18},children:r(x,{type:"text",placeholder:t["categoryCreate.form.name.placeholder"]})}),r(p.Item,{label:t["categoryCreate.form.pid.label"],field:"pid",labelCol:{span:6},wrapperCol:{span:18},rules:[{validator(l,i){e.data&&l===e.data.id&&i(t["categoryCreate.form.pid.error"]),i()}}],children:r(L,{treeData:e.pidOptions,fieldNames:{key:"id",title:"name"},placeholder:t["categoryCreate.form.pid.placeholder"],onChange:(l,i)=>{Object.keys(i).length===0?(u(1),a.setFieldValue("pid",0)):(u(i.trigger.dataRef.level+1),a.setFieldValue("pid",i.trigger.dataRef.id))},allowClear:!0})}),r(p.Item,{label:t["categoryCreate.form.code.label"],field:"code",labelCol:{span:6},wrapperCol:{span:18},children:r(x,{type:"text",placeholder:t["categoryCreate.form.code.placeholder"]})}),r(p.Item,{label:t["categoryCreate.form.sortIndex.label"],field:"sortIndex",labelCol:{span:6},wrapperCol:{span:18},initialValue:1,rules:[{validator(l,i){l&&l<1?i(t["categoryCreate.form.sortIndex.error"]):i()}}],children:r(F,{placeholder:t["categoryCreate.form.sortIndex.placeholder"]})})]})})}function te(){const e=h(q),t=h(D),a=f.exports.useRef(),[n,c]=I({visible:!1,close:()=>{c(o=>{o.visible=!1})}}),[v,u]=f.exports.useState(),[y]=I({reqDel:S});function l(o){const d=new Map,s=[];return o.forEach(m=>d.set(m.id,{...m,children:[]})),o.forEach(m=>{const b=d.get(m.pid);b?b.children.push(d.get(m.id)):s.push(d.get(m.id))}),s}f.exports.useEffect(()=>{c(o=>{o.pidOptions=a.current.getList()})},[a.current]);const i=[{title:t["columns.name"],dataIndex:"name"},{title:t["columns.action"],key:"option",render:(o,d)=>C(_,{children:[C(g,{type:"text",onClick:()=>{c(s=>{s.id=d.id,s.level=d.level,s.uuid=void 0,s.visible=!0}),u(void 0)},children:[r(T,{}),t["columns.action.create"]]}),C(g,{type:"text",onClick:()=>{c(s=>{s.id=void 0,s.level=void 0,s.uuid=d.uuid,s.visible=!0}),u({name:d.name,code:d.code,sortIndex:d.sort_index,pid:d.pid,id:d.id})},children:[r(j,{}),t["columns.action.edit"]]}),r(B,{reqDel:y.reqDel,params:{uuid:d.uuid},reload:()=>a.current.reload(),children:C(g,{type:"text",children:[r(G,{}),t["columns.action.delete"]]})})]})}];return C(E,{children:[r(N,{data:v,visible:n.visible,id:n.id,level:n.level,uuid:n.uuid,close:n.close,reload:()=>a.current.reload(),pidOptions:n.pidOptions}),r(M,{ref:a,request:V,dataRender:l,columns:i,pagination:!1,pageSize:!1,actionBarRender:[r(g,{type:"primary",onClick:()=>a.current.reload(),children:e["table.refresh"]},"refresh")],toolBarRender:[r(g,{type:"primary",onClick:()=>{c(o=>{o.id=void 0,o.visible=!0,o.uuid=void 0,o.level=void 0}),u(void 0)},children:e["table.createCategory"]},"create")]})]})}export{te as default};
