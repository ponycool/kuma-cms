import{h as m,u as B,av as o,r as p,j as t,bi as N,a as h,aj as T,af as F,aw as R,am as P,bo as D,i as W,aR as k,B as b,bh as $,bp as z,l as G,bj as H}from"./index.168693d9.js";import{U as J}from"./index.888e30c8.js";import{C as K}from"./index.73549d01.js";import{T as Q,P as X}from"./index.6ed99695.js";import{C as Y,D as Z}from"./DelPopconfirm.0a85d4f6.js";import"./index.902838da.js";import{t as ee}from"./index.f7a550cc.js";import{c as x}from"./convertNullToUndefined.a19d8223.js";import{q as ue}from"./index.db4fea0a.js";import{i as te}from"./use-immer.module.7239e392.js";import{I as ie}from"./image.3c933357.js";import{I as le}from"./index.138090a4.js";import{I as ae}from"./index.39e9cfd5.js";import{I as ne}from"./index.ec9adcaf.js";import"./index.7237a8ed.js";import"./index.ba1a255d.js";import"./index.b7f121bf.js";import"./index.f1c253ae.js";import"./b-tween.es.064e2a03.js";import"./index.6dc718b2.js";import"./index.9d1f9028.js";import"./index.7a7b5042.js";function re(i){return m.post("/api/menu/query",i)}function se(i){return m.post("/api/menu/delete",i)}function de(i){return m.post("/api/menu/create",i)}function oe(i){return m.post("/api/menu/update",i)}function ce(i){return m.post("/api/menu/enable",i)}function pe(i){return m.post("/api/menu/disable",i)}function L(){return m.post("/api/menu/type/query")}function me(){return m.post("/api/link/type/query")}function he(){return m.post("/api/module/query")}function be(i){return m.post("/api/menu/visible",i)}function ge(i){return m.post("/api/menu/hidden",i)}const M={"en-US":{create:"Create",update:"Update",cancel:"Cancel",save:"Save",parentMenu:"Parent Menu","parentMenu.required":"Parent menu is required","parentMenu.error":"Parent menu cannot be itself","parentMenu.placeholder":"Please enter a parent Menu",name:"Menu Name","name.placeholder":"Please enter a menu name","name.required":"Please enter a menu name",code:"Menu Code","code.placeholder":"Please enter a menu code","code.required":"Please enter a menu code",icon:"Menu Icon",noIcon:"No Icon",menuType:"Menu Type","menuType.placeholder":"Please select a menu type","menuType.required":"Please select a menu type",linkType:"Link Type","linkType.placeholder":"Please select a link type","linkType.required":"Please select a link type",linkUrl:"Link URL","linkUrl.placeholder":"Please enter a link URL","linkUrl.required":"Please enter a link URL",singlePage:"Single Page","singlePage.placeholder":"Please select a single page","singlePage.required":"Please select a single page",module:"Module","module.placeholder":"Please select a module","module.required":"Please select a module",target:"Target","target.placeholder":"Please select a target","target.required":"Please select a target",sortIndex:"Sort Index",isVisible:"Is Visible",isEnable:"Is Enable",action:"Action",edit:"Edit",visibleStatus:"Visible Status",visible:"Visible",hidden:"Hidden",enableStatus:"Enable Status",enable:"Enable",disable:"Disable",delete:"Delete"},"zh-CN":{create:"\u521B\u5EFA",update:"\u66F4\u65B0",cancel:"\u53D6\u6D88",save:"\u4FDD\u5B58",parentMenu:"\u7236\u7EA7\u83DC\u5355","parentMenu.required":"\u7236\u7EA7\u83DC\u5355\u4E0D\u80FD\u4E3A\u7A7A","parentMenu.error":"\u7236\u7EA7\u83DC\u5355\u4E0D\u80FD\u9009\u62E9\u81EA\u5DF1","parentMenu.placeholder":"\u8BF7\u9009\u62E9\u7236\u7EA7\u83DC\u5355",name:"\u83DC\u5355\u540D\u79F0","name.required":"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0","name.placeholder":"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0",code:"\u83DC\u5355\u7F16\u7801","code.required":"\u8BF7\u8F93\u5165\u83DC\u5355\u7F16\u7801","code.placeholder":"\u8BF7\u8F93\u5165\u83DC\u5355\u7F16\u7801",icon:"\u83DC\u5355\u56FE\u6807",noIcon:"\u6682\u65E0\u56FE\u6807",menuType:"\u83DC\u5355\u7C7B\u578B","menuType.placeholder":"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B","menuType.required":"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B",linkType:"\u94FE\u63A5\u7C7B\u578B","linkType.placeholder":"\u8BF7\u9009\u62E9\u94FE\u63A5\u7C7B\u578B","linkType.required":"\u8BF7\u9009\u62E9\u94FE\u63A5\u7C7B\u578B",linkUrl:"\u94FE\u63A5\u5730\u5740","linkUrl.placeholder":"\u8BF7\u8F93\u5165\u94FE\u63A5\u5730\u5740","linkUrl.required":"\u8BF7\u8F93\u5165\u94FE\u63A5\u5730\u5740",singlePage:"\u5355\u9875","singlePage.placeholder":"\u8BF7\u9009\u62E9\u5355\u9875","singlePage.required":"\u8BF7\u9009\u62E9\u5355\u9875",module:"\u6A21\u5757","module.placeholder":"\u8BF7\u9009\u62E9\u6A21\u5757","module.required":"\u8BF7\u9009\u62E9\u6A21\u5757",target:"\u8DF3\u8F6C\u65B9\u5F0F","target.placeholder":"\u8BF7\u9009\u62E9\u8DF3\u8F6C\u65B9\u5F0F","target.required":"\u8BF7\u9009\u62E9\u8DF3\u8F6C\u65B9\u5F0F",sortIndex:"\u6392\u5E8F",isVisible:"\u663E\u793A",isEnable:"\u542F\u7528",action:"\u64CD\u4F5C",edit:"\u7F16\u8F91",visibleStatus:"\u663E\u793A\u72B6\u6001",visible:"\u663E\u793A",hidden:"\u9690\u85CF",enableStatus:"\u542F\u7528\u72B6\u6001",enable:"\u542F\u7528",disable:"\u7981\u7528",delete:"\u5220\u9664"}};function fe(i){const e=B(M),[s]=o.useForm(),[y,E]=p.exports.useState(!1),[g,f]=p.exports.useState([]),[v,q]=p.exports.useState([]),[n,l]=p.exports.useState([]),[a,d]=p.exports.useState("link"),[C,S]=p.exports.useState([]),[A,w]=p.exports.useState([]),[U,V]=p.exports.useState([{name:"\u6839\u83DC\u5355",id:-1,children:[]}]);async function O(){console.log(s.getFieldsValue()),s.validate().then(async u=>{const r=x({...u,pid:u.pid===-1?0:u.pid,level:u.pid===-1?1:u.pid+1,icon:u.icon&&u.icon.length!==0?u.icon[0].response.data.name:void 0,enabled:!!u.enabled,visible:!!u.visible});try{let c;i.data?c=await oe(D({...r,uuid:i.data.uuid})):c=await de(D({...r})),c.code===0&&(i.reload(),i.close())}finally{E(!1)}}).catch(u=>{console.log(u),console.error("\u4FE1\u606F\u4E0D\u5B8C\u6574")})}return p.exports.useEffect(()=>{if(i.pid&&s.setFieldsValue({pid:i.pid===0?-1:i.pid}),i.data){const u=x(i.data),r=u.icon;s.setFieldsValue({...u,pid:u.pid===0?-1:u.pid,icon:u.icon?[{uid:u.icon,url:r,response:{data:{name:u.icon.replace("/media/image?n=",""),path:u.icon}}}]:[],visible:!!u.visible,enabled:!!u.enabled}),d(u.type)}},[i.data,i.pid]),p.exports.useEffect(()=>{if(i.visible===!1&&(d("link"),s.resetFields()),i.visible&&i.getList){console.log(i.getList());const u=i.getList(),r=c=>c.map(({name:j,id:_,children:I})=>({name:j,id:_,...I&&I.length?{children:r(I)}:{}}));V([{name:"\u6839\u83DC\u5355",id:-1,children:r(u)}])}},[s,i.visible]),p.exports.useEffect(()=>{L().then(u=>{const r=[];Object.keys(u.data).forEach(c=>{r.push({value:c,label:u.data[c]})}),f(r)}),ee().then(u=>{const r=[];Object.keys(u.data).forEach(c=>{r.push({value:c,label:u.data[c]})}),q(r)}),me().then(u=>{const r=[];Object.keys(u.data).forEach(c=>{r.push({value:u.data[c],label:c})}),l(r)}),ue({isPage:!1}).then(u=>{S(u.data)}),he().then(u=>{w(u.data)})},[]),t(N,{width:600,title:i.data?e.update:e.create,visible:i.visible,onOk:O,onCancel:i.close,confirmLoading:y,okText:i.data?e.save:e.create,children:h(o,{form:s,labelCol:{span:6},wrapperCol:{span:18},onChange:u=>{console.log(u)},children:[t(o.Item,{label:e.parentMenu,field:"pid",rules:[{required:!0,message:e["parentMenu.required"]},{validator(u,r){i.data&&u===i.data.id&&r(e["parentMenu.error"]),r()}}],initialValue:-1,disabled:!!i.pid,children:t(Q,{treeData:U,fieldNames:{key:"id",title:"name"},placeholder:e["parentMenu.placeholder"],onChange:(u,r)=>{Object.keys(r).length===0?s.setFieldValue("pid",-1):s.setFieldValue("pid",r.trigger.dataRef.id)}})}),t(o.Item,{label:e.name,field:"name",rules:[{required:!0,message:e["name.required"]}],children:t(T,{maxLength:100,showWordLimit:!0,placeholder:e["name.placeholder"]})}),t(o.Item,{label:e.code,field:"code",children:t(T,{maxLength:20,showWordLimit:!0,placeholder:e["code.placeholder"]})}),t(o.Item,{label:e.icon,field:"icon",triggerPropName:"fileList",children:t(J,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),t(o.Item,{label:e.menuType,field:"type",rules:[{required:!0,message:e["menuType.required"]}],initialValue:"link",children:t(F,{options:g,placeholder:e["menuType.placeholder"],onChange:d})}),a==="link"&&t(o.Item,{label:e.linkType,field:"link_type",rules:[{required:!0,message:e["linkType.required"]}],initialValue:0,children:t(F,{options:n})}),a==="link"&&t(o.Item,{label:e.linkUrl,field:"link_url",rules:[{required:!0,message:e["linkUrl.required"]}],children:t(T,{maxLength:100,showWordLimit:!0,placeholder:e["linkUrl.placeholder"]})}),a==="single_page"&&t(o.Item,{label:e.singlePage,field:"single_page_id",rules:[{required:!0,message:e["singlePage.required"]}],children:t(F,{showSearch:!0,filterOption:(u,r)=>(console.log(u,r),r.props.children.toLowerCase().includes(u.toLowerCase())),options:C.map(u=>({label:u.title,value:u.id})),placeholder:e["singlePage.placeholder"]})}),a==="module"&&t(o.Item,{label:e.module,field:"link_url",rules:[{required:!0,message:e["module.required"]}],children:t(F,{options:A.map(u=>({label:u.text,value:u.link})),placeholder:e["module.placeholder"]})}),t(o.Item,{label:e.target,field:"target",rules:[{required:!0,message:e["target.required"]}],initialValue:"_blank",children:t(F,{options:v,placeholder:e["target.placeholder"]})}),t(o.Item,{label:e.sortIndex,field:"sort_index",initialValue:1,children:t(R,{min:1,step:1,precision:0})}),t(o.Item,{label:e.isVisible,field:"visible",triggerPropName:"checked",initialValue:!0,children:t(P,{})}),t(o.Item,{label:e.isEnable,field:"enabled",triggerPropName:"checked",initialValue:!1,children:t(P,{})})]})})}function _e(){const i=B(W),e=B(M),s=p.exports.useRef(),[y,E]=p.exports.useState(),[g,f]=te({visible:!1,close:()=>{f(n=>{n.visible=!1,n.data=void 0,n.pid=void 0})}}),v=[{title:"ID",dataIndex:"id"},{title:e.name,dataIndex:"name"},{title:e.code,dataIndex:"code"},{title:e.icon,width:150,render:(n,l)=>{if(l.icon){let a="";return a=l.icon,t(ie,{width:40,height:40,src:a})}else return e.noIcon}},{title:e.menuType,render(n,l){return y&&y[l.type]}},{title:e.visibleStatus,render(n,l){return l.visible?t(k,{color:"green",children:e.visible}):t(k,{color:"red",children:e.hidden})}},{title:e.enableStatus,render(n,l){return l.enabled?t(k,{color:"green",children:e.enable}):t(k,{color:"red",children:e.disable})}},{title:e.action,key:"option",render:(n,l)=>h(Y,{children:[h(b,{type:"text",onClick:()=>{f(a=>{a.visible=!0,a.pid=l.id})},children:[t(le,{}),e.create]}),h(b,{type:"text",onClick:()=>{f(a=>{a.visible=!0,a.data=l})},children:[t($,{}),e.edit]}),h(b,{type:"text",onClick:async()=>{var d;let a;l.visible?a=await(a=ge({uuid:l.uuid})):a=await(a=be({uuid:l.uuid})),a.code===0&&((d=s.current)==null||d.reload())},children:[l.visible?t(z,{}):t(G,{}),l.visible?e.hidden:e.visible]}),h(b,{type:"text",onClick:async()=>{var d;let a;l.enabled?a=a=await pe({uuid:l.uuid}):a=a=await ce({uuid:l.uuid}),a.code===0&&((d=s.current)==null||d.reload())},children:[l.enabled?t(ae,{}):t(H,{}),l.enabled?e.disable:e.enable]}),t(Z,{reqDel:se,params:{uuid:l.uuid},reload:()=>s.current.reload(),children:h(b,{type:"text",children:[t(ne,{}),e.delete]})})]})}];function q(n){const l=new Map,a=[];return n.forEach(d=>l.set(d.id,{...d,children:[]})),n.forEach(d=>{const C=l.get(d.pid);C?C.children.push(l.get(d.id)):a.push(l.get(d.id))}),a}return p.exports.useEffect(()=>{L().then(n=>{E(n.data)})},[]),h(K,{children:[t(fe,{pid:g.pid,data:g.data,visible:g.visible,close:g.close,reload:()=>{var n;return(n=s.current)==null?void 0:n.reload()},getList:()=>{var n;return(n=s.current)==null?void 0:n.getList()}}),t(X,{ref:s,request:re,dataRender:q,columns:v,pagination:!1,pageSize:!1,actionBarRender:[t(b,{type:"primary",onClick:()=>{var n;return(n=s.current)==null?void 0:n.reload()},children:i["table.refresh"]},"refresh")],toolBarRender:[t(b,{type:"primary",onClick:()=>{f(n=>{n.visible=!0})},children:i["table.create"]},"create")]})]})}export{_e as default};
