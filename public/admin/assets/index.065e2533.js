import{av as p,r as c,j as i,bd as D,a as v,aj as x,aw as I,M as E,u as y,i as B,B as h,bc as w}from"./index.bd6f0fd9.js";import{C as k}from"./index.015e15aa.js";import{T as q,P as j}from"./index.3693d17a.js";import{r as L,j as M,i as O,k as R,c as S}from"./index.03458a2d.js";import{C as V,D as _}from"./DelPopconfirm.f694f4a0.js";import{i as F}from"./use-immer.module.0f20ac89.js";import{I as A}from"./index.3fa650b2.js";import{I as T}from"./index.e54eee63.js";import"./index.b75b57f1.js";import"./b-tween.es.064e2a03.js";import"./index.fc500d5c.js";import"./index.f7527960.js";import"./index.37183713.js";function G(e){const[t]=p.useForm(),[d,u]=c.exports.useState(!1),[n,f]=c.exports.useState(1);c.exports.useEffect(()=>(e.level&&f(e.level+1),()=>{f(1)}),[e.level]),c.exports.useEffect(()=>{e.data?(t.setFieldsValue(e.data),t.setFieldValue("pid",e.data.pid)):e.id&&t.setFieldValue("pid",e.id),e.visible||t.resetFields()},[t,e.data,e.visible]);async function C(){t.validate().then(async l=>{var b;u(!0);let a;e.uuid?a=await L({...l,uuid:e.uuid,pid:l.pid,level:n,sortIndex:l.sortIndex||1}):a=await M({...l,pid:(b=l.pid)!=null?b:0,level:n,sortIndex:l.sortIndex||1}),a.code===0&&(E.success(a.message),e.reload(),e.close(),t.resetFields())}).catch(l=>{console.log(l)}).finally(()=>{u(!1)})}return i(D,{width:400,title:e.uuid?"\u66F4\u65B0\u5206\u7C7B":"\u521B\u5EFA\u5206\u7C7B",visible:e.visible,onOk:C,onCancel:e.close,confirmLoading:d,okText:e.uuid?"\u4FDD\u5B58":"\u521B\u5EFA",children:v(p,{form:t,children:[i(p.Item,{label:"\u5206\u7C7B\u540D\u79F0",field:"name",rules:[{required:!0,message:!0}],labelCol:{span:6},wrapperCol:{span:18},children:i(x,{type:"text"})}),i(p.Item,{label:"\u7236\u7EA7\u5206\u7C7B",field:"pid",labelCol:{span:6},wrapperCol:{span:18},rules:[{validator(l,a){e.data&&l===e.data.id&&a("\u4E0D\u53EF\u9009\u62E9\u5F53\u524D\u5206\u7C7B!"),a()}}],children:i(q,{treeData:e.pidOptions,fieldNames:{key:"id",title:"name"},placeholder:"\u6839\u7EA7",onChange:(l,a)=>{Object.keys(a).length===0?(f(1),t.setFieldValue("pid",0)):(f(a.trigger.dataRef.level+1),t.setFieldValue("pid",a.trigger.dataRef.id))},allowClear:!0})}),i(p.Item,{label:"\u5206\u7C7B\u7F16\u7801",field:"code",labelCol:{span:6},wrapperCol:{span:18},children:i(x,{type:"text"})}),i(p.Item,{label:"\u6392\u5E8F",field:"sortIndex",labelCol:{span:6},wrapperCol:{span:18},initialValue:1,rules:[{validator(l,a){l&&l<1?a("\u6392\u5E8F\u5FC5\u987B\u5927\u4E8E0"):a()}}],children:i(I,{})})]})})}function ee(){const e=y(B),t=y(O),d=c.exports.useRef(),[u,n]=F({visible:!1,close:()=>{n(s=>{s.visible=!1})}}),[f,C]=c.exports.useState(),[l]=F({reqDel:R});function a(s){const r=new Map,o=[];return s.forEach(m=>r.set(m.id,{...m,children:[]})),s.forEach(m=>{const g=r.get(m.pid);g?g.children.push(r.get(m.id)):o.push(r.get(m.id))}),o}c.exports.useEffect(()=>{n(s=>{s.pidOptions=d.current.getList()})},[d.current]);const b=[{title:t["columns.name"],dataIndex:"name"},{title:t["columns.action"],key:"option",render:(s,r)=>v(V,{children:[v(h,{type:"text",onClick:()=>{n(o=>{o.id=r.id,o.level=r.level,o.uuid=void 0,o.visible=!0}),C(void 0)},children:[i(A,{}),t["columns.action.create"]]}),v(h,{type:"text",onClick:()=>{n(o=>{o.id=void 0,o.level=void 0,o.uuid=r.uuid,o.visible=!0}),C({name:r.name,code:r.code,sortIndex:r.sort_index,pid:r.pid,id:r.id})},children:[i(w,{}),t["columns.action.edit"]]}),i(_,{reqDel:l.reqDel,params:{uuid:r.uuid},reload:()=>d.current.reload(),children:v(h,{type:"text",children:[i(T,{}),t["columns.action.delete"]]})})]})}];return v(k,{children:[i(G,{data:f,visible:u.visible,id:u.id,level:u.level,uuid:u.uuid,close:u.close,reload:()=>d.current.reload(),pidOptions:u.pidOptions}),i(j,{ref:d,request:S,dataRender:a,columns:b,pagination:!1,pageSize:!1,actionBarRender:[i(h,{type:"primary",onClick:()=>d.current.reload(),children:e["table.refresh"]},"refresh")],toolBarRender:[i(h,{type:"primary",onClick:()=>{n(s=>{s.id=void 0,s.visible=!0,s.uuid=void 0,s.level=void 0}),C(void 0)},children:e["table.createCategory"]},"create")]})]})}export{ee as default};
