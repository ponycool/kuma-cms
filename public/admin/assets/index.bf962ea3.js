import{av as m,r as c,j as i,bd as I,a as v,aj as y,aw as E,az as B,M as w,u as F,i as k,B as C,bc as R}from"./index.bd6f0fd9.js";import{C as L}from"./index.015e15aa.js";import{T as M,P as O}from"./index.3693d17a.js";import{c as S,a as V,i as j,b as q,d as A}from"./index.09d5537d.js";import{C as T,D as G}from"./DelPopconfirm.f694f4a0.js";import{i as D}from"./use-immer.module.0f20ac89.js";import{I as _}from"./index.3fa650b2.js";import{I as z}from"./index.e54eee63.js";import"./index.b75b57f1.js";import"./b-tween.es.064e2a03.js";import"./index.fc500d5c.js";import"./index.f7527960.js";import"./index.37183713.js";const{Row:N,Col:g}=B;function P(e){const[l]=m.useForm(),[o,d]=c.exports.useState(!1),[u,f]=c.exports.useState(1);c.exports.useEffect(()=>(e.level&&f(e.level+1),()=>{f(1)}),[e.level]),c.exports.useEffect(()=>{e.data?(l.setFieldsValue(e.data),l.setFieldValue("pid",e.data.pid)):e.id&&l.setFieldValue("pid",e.id),e.visible||l.resetFields()},[l,e.data,e.visible]);async function h(){l.validate().then(async t=>{var b;d(!0);let a;e.uuid?a=await S({...t,uuid:e.uuid,pid:t.pid,level:u,sortIndex:t.sortIndex||1}):a=await V({...t,sortIndex:t.sortIndex||1,pid:(b=t.pid)!=null?b:0,level:u}),a.code===0&&(w.success(a.message),e.reload(),e.close(),l.resetFields())}).catch(t=>{console.log(t)}).finally(()=>{d(!1)})}return i(I,{width:400,title:e.uuid?"\u66F4\u65B0\u5206\u7C7B":"\u521B\u5EFA\u5206\u7C7B",visible:e.visible,onOk:h,onCancel:e.close,confirmLoading:o,okText:e.uuid?"\u4FDD\u5B58":"\u521B\u5EFA",children:i(m,{form:l,children:v(N,{children:[i(g,{span:24,children:i(m.Item,{label:"\u5206\u7C7B\u540D\u79F0",field:"name",rules:[{required:!0,message:!0}],labelCol:{span:6},wrapperCol:{span:18},children:i(y,{type:"text"})})}),i(g,{span:24,children:i(m.Item,{label:"\u7236\u7EA7\u5206\u7C7B",field:"pid",labelCol:{span:6},wrapperCol:{span:18},rules:[{validator(t,a){e.data&&t===e.data.id&&a("\u4E0D\u53EF\u9009\u62E9\u5F53\u524D\u5206\u7C7B!"),a()}}],children:i(M,{treeData:e.pidOptions,fieldNames:{key:"id",title:"name"},placeholder:"\u6839\u7EA7",onChange:(t,a)=>{Object.keys(a).length===0?(f(1),l.setFieldValue("pid",0)):(f(a.trigger.dataRef.level+1),l.setFieldValue("pid",a.trigger.dataRef.id))},allowClear:!0})})}),i(g,{span:24,children:i(m.Item,{label:"\u5206\u7C7B\u7F16\u7801",field:"code",labelCol:{span:6},wrapperCol:{span:18},children:i(y,{type:"text"})})}),i(g,{span:24,children:i(m.Item,{label:"\u6392\u5E8F",field:"sortIndex",labelCol:{span:6},wrapperCol:{span:18},initialValue:1,rules:[{validator(t,a){t&&t<1?a("\u6392\u5E8F\u5FC5\u987B\u5927\u4E8E0"):a()}}],children:i(E,{})})})]})})})}function te(){const e=F(k),l=F(j),o=c.exports.useRef(),[d,u]=D({visible:!1,close:()=>{u(r=>{r.visible=!1})}}),[f,h]=c.exports.useState(),[t]=D({reqDel:q});function a(r){const s=new Map,n=[];return r.forEach(p=>s.set(p.id,{...p,children:[]})),r.forEach(p=>{const x=s.get(p.pid);x?x.children.push(s.get(p.id)):n.push(s.get(p.id))}),n}c.exports.useEffect(()=>{u(r=>{r.pidOptions=o.current.getList()})},[o.current]);const b=[{title:l["columns.name"],dataIndex:"name"},{title:l["columns.action"],key:"option",render:(r,s)=>v(T,{children:[v(C,{type:"text",onClick:()=>{u(n=>{n.id=s.id,n.level=s.level,n.uuid=void 0,n.visible=!0}),h(void 0)},children:[i(_,{}),l["columns.action.create"]]}),v(C,{type:"text",onClick:()=>{u(n=>{n.id=void 0,n.level=void 0,n.uuid=s.uuid,n.visible=!0}),h({name:s.name,code:s.code,sortIndex:s.sort_index,pid:s.pid,id:s.id})},children:[i(R,{}),l["columns.action.edit"]]}),i(G,{reqDel:t.reqDel,params:{uuid:s.uuid},reload:()=>o.current.reload(),children:v(C,{type:"text",children:[i(z,{}),l["columns.action.delete"]]})})]})}];return v(L,{children:[i(P,{data:f,visible:d.visible,id:d.id,level:d.level,uuid:d.uuid,close:d.close,reload:()=>o.current.reload(),pidOptions:d.pidOptions}),i(O,{ref:o,request:A,dataRender:a,columns:b,pagination:!1,pageSize:!1,actionBarRender:[i(C,{type:"primary",onClick:()=>o.current.reload(),children:e["table.refresh"]},"refresh")],toolBarRender:[i(C,{type:"primary",onClick:()=>{u(r=>{r.id=void 0,r.visible=!0,r.uuid=void 0,r.level=void 0}),h(void 0)},children:e["table.createCategory"]},"create")]})]})}export{te as default};
