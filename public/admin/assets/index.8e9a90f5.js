import{aj as k,u as L,r as p,bb as j,av as d,a as f,j as t,K as O,B as g,aw as v,am as F,b5 as M,M as z,i as B,bh as R,aR as D,b7 as J,F as U}from"./index.4407656a.js";import{U as P,I as V}from"./index.a1a82b6a.js";import{C as q}from"./index.cac83c98.js";import{T as W,P as A}from"./index.783305fe.js";import{i as N,d as E,u as K,e as G,f as H,g as Q,r as $,p as X,h as Y}from"./index.b2768af9.js";import{C as Z,D as ee}from"./DelPopconfirm.d2e8d19b.js";import"./index.f506b7ee.js";import{M as te}from"./index.c418e56c.js";import{c as S}from"./convertNullToUndefined.a19d8223.js";import{i as ae}from"./use-immer.module.5929a046.js";import{I as re}from"./image.08bd3ec8.js";import{I as oe}from"./index.f050451a.js";import{I as ie}from"./index.4f472b70.js";import"./index.34d7b197.js";import"./index.a24d88dc.js";import"./index.6b467fac.js";import"./index.16d8a506.js";import"./b-tween.es.064e2a03.js";import"./index.f4cf9ceb.js";import"./index.44cbcf0d.js";const T=k.TextArea;function le(l){const e=L(N),{lang:m}=p.exports.useContext(j),[C]=d.useForm(),[y,h]=p.exports.useState(""),[b,x]=p.exports.useState(!1),[w,_]=p.exports.useState([]);async function c(){try{const a=await E();if(a.code===0){const r=a.data,u=new Map,i=[];r.forEach(n=>u.set(n.id,{...n,children:[]})),r.forEach(n=>{const I=u.get(n.pid);I?I.children.push(u.get(n.id)):i.push(u.get(n.id))}),_(i)}}catch{}}function o(a){h(a)}async function s(){C.validate().then(async a=>{x(!0);const r=S(a);try{if(!y||y==="<p><br></p>")throw z.error(e["productCreate.form.description.required"]),new Error(e["productCreate.form.description.required"]);const u={...r,cover_image:r.cover_image&&r.cover_image.length!==0?r.cover_image[0].response.data.name:void 0,detail_images:r.detail_images&&r.detail_images.length!==0?JSON.stringify(r.detail_images.map(n=>n.response.data.name)):void 0,status:r.status?"true":"false",description:y,stock_quantity:r.stock_quantity||0,price:r.price||0,sort_index:r.sort_index||1};let i;l.data?i=await K({...u,uuid:l.data.uuid}):i=await G(u),i.code===0&&(l.reload(),l.close())}finally{x(!1)}}).catch(()=>{console.error(e["productCreate.form.description.error"])})}return p.exports.useEffect(()=>{c()},[]),p.exports.useEffect(()=>{if(l.data){const a=S(l.data),r=a.cover_image;C.setFieldsValue({...a,status:a.status===1,cover_image:a.cover_image?[{uid:a.cover_image,url:r,response:{data:{name:a.cover_image.replace("/media/image?n=",""),path:a.cover_image}}}]:[],detail_images:a.detail_images?JSON.parse(a.detail_images).map((u,i)=>({uid:i,url:u,response:{data:{name:u.replace("/media/image?n=",""),path:u}}})):[]}),h(l.data.description)}},[l.data]),p.exports.useEffect(()=>{l.visible===!1&&C.resetFields()},[C,l.visible]),f(q,{title:l.data?e["productCreate.title.update"]:e["productCreate.title.create"],extra:t(O,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>l.close()}),actions:[t(g,{type:"default",onClick:()=>l.close(),children:e["productCreate.button.cancel"]},"cancel"),t(g,{type:"primary",loading:b,onClick:s,children:l.data?e["productCreate.button.save"]:e["productCreate.button.create"]},"submit")],children:[f(d,{form:C,labelCol:{span:m==="zh-CN"?2:3},wrapperCol:{span:m==="zh-CN"?22:21},children:[t(d.Item,{label:e["productCreate.form.name.label"],field:"name",rules:[{required:!0,message:e["productCreate.form.name.required"]}],children:t(k,{maxLength:100,showWordLimit:!0,placeholder:e["productCreate.form.name.placeholder"]})}),t(d.Item,{label:e["productCreate.form.category.label"],field:"cid",rules:[{required:!0,message:e["productCreate.form.category.required"]}],wrapperCol:{span:2},children:t(W,{treeData:w,fieldNames:{key:"id",title:"name"},allowClear:!0,placeholder:e["productCreate.form.category.placeholder"]})}),t(d.Item,{label:e["productCreate.form.coverImage.label"],field:"cover_image",triggerPropName:"fileList",children:t(P,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),t(d.Item,{label:e["productCreate.form.detailImage.label"],field:"detail_images",triggerPropName:"fileList",children:t(P,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card"})}),t(d.Item,{label:e["productCreate.form.seoTitle.label"],field:"seo_title",children:t(k,{maxLength:200,showWordLimit:!0,placeholder:e["productCreate.form.seoTitle.placeholder"]})}),t(d.Item,{label:e["productCreate.form.seoDesc.label"],field:"seo_desc",children:t(T,{maxLength:200,placeholder:e["productCreate.form.seoDesc.placeholder"],showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),t(d.Item,{label:e["productCreate.form.seoKeywords.label"],field:"seo_keywords",children:t(T,{maxLength:200,placeholder:e["productCreate.form.seoKeywords.placeholder"],showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),t(d.Item,{label:e["productCreate.form.price.label"],field:"price",wrapperCol:{span:2},initialValue:0,children:t(v,{maxLength:10,hideControl:!0,placeholder:e["productCreate.form.price.placeholder"],precision:2})}),t(d.Item,{label:e["productCreate.form.stock.label"],field:"stock_quantity",wrapperCol:{span:2},initialValue:0,children:t(v,{maxLength:10,hideControl:!0,precision:0,placeholder:e["productCreate.form.stock.placeholder"]})}),t(d.Item,{label:e["productCreate.form.sortIndex.label"],field:"sort_index",wrapperCol:{span:2},initialValue:1,rules:[{validator(a,r){a&&a<1?r(e["productCreate.form.sortIndex.error"]):r()}}],children:t(v,{maxLength:10,hideControl:!0,precision:0,placeholder:e["productCreate.form.sortIndex.placeholder"]})}),t(d.Item,{label:e["productCreate.form.status.label"],field:"status",triggerPropName:"checked",children:t(F,{})})]}),t(M,{orientation:"left",children:e["productCreate.form.description.label"]}),t(te,{html:y,getContent:o})]})}function De(){const l=L(B),e=L(N),m=p.exports.useRef(),[C,y]=p.exports.useState([]),[h,b]=ae({visible:!1,close:function(){b(c=>{c.visible=!1})}});async function x(c){const s=(await E()).data||[],a=new Map,r=[];return s.forEach(i=>a.set(i.id,{...i,children:[]})),s.forEach(i=>{const n=a.get(i.pid);n?n.children.push(a.get(i.id)):r.push(a.get(i.id))}),y(r),c.map(i=>{const n=s.find(I=>I.id===i.cid);return{...i,category:n?n.name:null}})}async function w(c){try{const o=await Y({uuid:c});o.code===0&&b(s=>{s.data=o.data,s.visible=!0})}catch{}}const _=[{title:e["columns.keyword"],dataIndex:"keyword",search:!0,hide:!0},{title:e["columns.category"],dataIndex:"cid",search:!0,hide:!0,valueType:"treeSelect",fieldProps:{treeData:C,fieldNames:{key:"id",title:"name"},allowClear:!0}},{title:"ID",dataIndex:"id"},{title:e["columns.title"],dataIndex:"name",ellipsis:!0},{title:e["columns.productImage"],width:150,dataIndex:"cover_image",render:(c,o)=>{if(o.cover_image){let s="";return s=o.cover_image,t(re,{width:40,height:40,src:s})}else return t(R,{style:{width:40,height:40}})}},{title:e["columns.category"],ellipsis:!0,dataIndex:"category"},{title:e["columns.price"],dataIndex:"price",render(c,o){return o.price||0}},{title:e["columns.stockQuantity"],dataIndex:"stock_quantity",render(c,o,s){return o.stock_quantity||0}},{title:e["columns.views"],dataIndex:"view_count"},{title:e["columns.isPublished"],dataIndex:"is_published",render(c,o){return o.status===1?t(D,{color:"green",children:e["columns.isPublished.published"]}):t(D,{color:"red",children:e["columns.isPublished.unPublished"]})}},{title:e["columns.updateAt"],width:180,dataIndex:"updated_at"},{title:e["columns.action"],width:280,render:(c,o)=>f(Z,{children:[f(g,{type:"text",onClick:()=>w(o.uuid),children:[t(J,{}),e["columns.action.edit"]]}),o.status===0?f(g,{type:"text",onClick:async()=>{(await H(o.uuid)).code===0&&m.current.reload()},children:[t(V,{}),e["columns.action.publish"]]}):f(g,{type:"text",onClick:async()=>{(await Q(o.uuid)).code===0&&m.current.reload()},children:[t(oe,{}),e["columns.action.unPublish"]]}),t(ee,{reqDel:$,params:{uuid:o.uuid},reload:()=>m.current.reload(),children:f(g,{type:"text",children:[t(ie,{}),e["columns.action.delete"]]})})]})}];return f(U,{children:[h.visible&&t(le,{visible:h.visible,data:h.data,close:()=>h.close(),reload:()=>m.current.reload()}),t(q,{style:{display:h.visible?"none":void 0},children:t(A,{ref:m,request:X,columns:_,dataRender:x,actionBarRender:[t(g,{type:"primary",onClick:()=>m.current.reload(),children:l["table.refresh"]},"refresh")],toolBarRender:[t(g,{type:"primary",onClick:()=>{b(c=>{c.visible=!0,c.data=void 0})},children:l["table.createProduct"]},"create")]})})]})}export{De as default};
