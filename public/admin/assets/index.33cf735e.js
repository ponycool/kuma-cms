import{h as p,u as f,i as h,R as E,r as v,j as t,a as o,B as c,M as s}from"./index.977159c0.js";import"./index.d4fb97f6.js";import{U as y,I as C}from"./index.7d81e28c.js";import{T as d}from"./index.6c59eb1b.js";import{C as g}from"./index.c03e8cb5.js";import{C as A,D as k}from"./DelPopconfirm.3a31f457.js";import{P as w}from"./index.bdad4791.js";import{d as x}from"./download.9953d649.js";import{i as I}from"./use-immer.module.330565dc.js";import{I as S}from"./index.d455fbb7.js";import{I as T}from"./index.4f936e02.js";import"./index.c0aafd8b.js";import"./index.a53f2fef.js";import"./index.e1fa5068.js";import"./index.eebf02a4.js";import"./index.eb4ef983.js";import"./b-tween.es.064e2a03.js";import"./index.3a43c130.js";import"./index.96a6bd57.js";function z(){return p.post("/api/backup/server/backup",{})}function R(){return p.post("/api/backup/server/query",{})}function N(u){return p.post("/api/backup/server/delete",u)}function U(u){return p.post("/api/backup/server/restore",u)}const L={"en-US":{localBackup:"Local Backup",uploadBackup:"Upload Backup",fileName:"File Name",backupAt:"BackupAt",fileSize:"File Size",action:"Action",downloadBackup:"Download Backup",confirm:"Are you sure to restore the database from the server database backup?",content:"The current database will be overwritten after recovery",recovery:"Recovery Database",delete:"Delete Backup",remote:"Remote Backup",development:"Functional development"},"zh-CN":{localBackup:"\u672C\u5730\u5907\u4EFD",uploadBackup:"\u4E0A\u4F20\u5907\u4EFD",fileName:"\u6587\u4EF6\u540D",backupAt:"\u5907\u4EFD\u65F6\u95F4",fileSize:"\u6587\u4EF6\u5927\u5C0F",action:"\u64CD\u4F5C",downloadBackup:"\u4E0B\u8F7D\u5907\u4EFD",confirm:"\u786E\u8BA4\u4ECE\u670D\u52A1\u5668\u6570\u636E\u5E93\u5907\u4EFD\u6062\u590D\u6570\u636E\u5E93\uFF1F",content:"\u6062\u590D\u540E\u5C06\u4F1A\u8986\u76D6\u5F53\u524D\u6570\u636E\u5E93",recovery:"\u6062\u590D\u6570\u636E\u5E93",delete:"\u5220\u9664\u5907\u4EFD",remote:"\u8FDC\u7A0B\u5907\u4EFD",development:"\u529F\u80FD\u5F00\u53D1\u4E2D"}};function te(){const u=f(h),a=f(L),r=E.useRef(null),[m,i]=I({backup:!1,upload:!1}),[b,D]=v.exports.useState("local"),F=async()=>{var n;i(e=>{e.backup=!0});try{const e=await z();e.code===0&&(s.success(e.message),(n=r.current)==null||n.reload())}finally{i(e=>{e.backup=!1})}};return t(g,{children:o(d,{activeTab:b,onChange:D,type:"rounded",children:[t(d.TabPane,{title:a.localBackup,children:t(w,{ref:r,toolBarRender:[t(c,{type:"primary",loading:m.backup,onClick:F,children:u["table.dataBackup"]},"backup"),t(y,{action:"/api/backup/server/upload",data:{token:JSON.parse(localStorage.getItem("token")).token},showUploadList:!1,accept:".db",onChange:(n,e)=>{if(e.status==="uploading")i(l=>{l.upload=!0});else if(e.status==="done"){const l=e.response;l.code===0?(s.success(l.message),r.current.reload()):s.error(l.message),i(B=>{B.upload=!1})}},children:t(c,{type:"primary",loading:m.upload,children:a.uploadBackup},"backup")},"upload")],columns:[{title:a.fileName,dataIndex:"filename"},{title:a.backupAt,dataIndex:"created_at"},{title:a.fileSize,dataIndex:"size",render(n,e){return`${e.size}MB`}},{title:a.action,render(n,e){return o(A,{children:[o(c,{type:"text",onClick:()=>{x("/api/backup/server/download",{filename:e.filename})},children:[t(S,{}),a.downloadBackup]}),t(k,{reqDel:U,params:{filename:e.filename},reload:()=>{r.current.reload()},title:a.confirm,content:a.content,children:o(c,{type:"text",children:[t(C,{}),a.recovery]})}),t(k,{reqDel:N,params:{filename:e.filename},reload:()=>{r.current.reload()},children:o(c,{type:"text",children:[t(T,{}),a.delete]})})]})}}],request:R})},"local"),t(d.TabPane,{title:a.remote,children:o("p",{style:{padding:20,fontSize:16,fontWeight:800},children:[" ",a.development,"..."]})},"remote")]})})}export{te as default};
