import{h as m,aj as b,u as g,av as d,r as h,j as a,K as B,B as s,a as p,af as E,i as D,bc as T,M as q,aN as w,F as k}from"./index.a479fa95.js";import{C as x}from"./index.1baf6dfe.js";import{P as I}from"./index.c9221c57.js";import{C as L,D as N}from"./DelPopconfirm.207e268d.js";import{c as S}from"./convertNullToUndefined.a19d8223.js";import{i as _}from"./use-immer.module.97f668e8.js";import{I as A}from"./index.fc2a2722.js";import"./index.5b9e61b6.js";import"./b-tween.es.064e2a03.js";import"./index.5a2540cd.js";import"./index.e7b908db.js";import"./index.a45a4c94.js";function P(t){return m.post("/api/marketing/channel/query",t)}function R(t){return m.post("/api/marketing/channel/detail",t)}function j(t){return m.post("/api/marketing/channel/create",t)}function z(t){return m.post("/api/marketing/channel/update",t)}function W(t){return m.post("/api/marketing/channel/delete",t)}function $(){return m.post("/api/marketing/channel/type")}const H={"en-US":{channelName:"channel name",channelType:"channel type",description:"description",sourceCode:"source code",updateAt:"update at",edit:"edit",copyLink:"copy link",delete:"delete",copySuccess:"Copy success",copyFail:"Copy failed, please try again",cancel:"cancel",save:"save",create:"create",update:"update","channelName.placeholder":"Please enter channel name","channelName.required":"Channel name is required","channelType.placeholder":"Please select channel type","channelType.required":"Channel type is required","description.placeholder":"Please enter description","sourceCode.placeholder":"Please enter source code","sourceCode.required":"Source code is required"},"zh-CN":{channelName:"\u6E20\u9053\u540D\u5B57",channelType:"\u6E20\u9053\u7C7B\u578B",description:"\u63CF\u8FF0",sourceCode:"\u6E20\u9053\u4EE3\u7801",updateAt:"\u66F4\u65B0\u65F6\u95F4",edit:"\u7F16\u8F91",copyLink:"\u590D\u5236\u94FE\u63A5",delete:"\u5220\u9664",copySuccess:"\u590D\u5236\u6210\u529F",copyFail:"\u590D\u5236\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5",cancel:"\u53D6\u6D88",save:"\u4FDD\u5B58",create:"\u521B\u5EFA",update:"\u66F4\u65B0","channelName.placeholder":"\u8BF7\u8F93\u5165\u6E20\u9053\u540D\u5B57","channelName.required":"\u6E20\u9053\u540D\u5B57\u662F\u5FC5\u586B\u9879","channelType.placeholder":"\u8BF7\u9009\u62E9\u6E20\u9053\u7C7B\u578B","channelType.required":"\u6E20\u9053\u7C7B\u578B\u662F\u5FC5\u586B\u9879","description.placeholder":"\u8BF7\u8F93\u5165\u63CF\u8FF0","sourceCode.placeholder":"\u8BF7\u8F93\u5165\u6E20\u9053\u4EE3\u7801","sourceCode.required":"\u6E20\u9053\u4EE3\u7801\u662F\u5FC5\u586B\u9879"}};var v=H;const M=b.TextArea;function O(t){const e=g(v),[n]=d.useForm(),[o,f]=h.exports.useState(!1);async function u(){n.validate().then(async l=>{f(!0);try{const C={...l};let y;t.data?y=await z({...C,uuid:t.data.uuid}):y=await j(C),y.code===0&&(t.reload(),t.close())}finally{f(!1)}})}return h.exports.useEffect(()=>{if(t.data){const l=S(t.data);n.setFieldsValue(l)}},[t.data]),h.exports.useEffect(()=>{t.visible===!1&&n.resetFields()},[n,t.visible]),a(x,{title:t.data?e.update:e.create,extra:a(B,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>t.close()}),actions:[a(s,{type:"default",onClick:()=>t.close(),children:e.cancel},"cancel"),a(s,{type:"primary",loading:o,onClick:u,children:t.data?e.save:e.create},"submit")],children:p(d,{form:n,labelCol:{span:2},wrapperCol:{span:8},children:[a(d.Item,{label:e.channelName,field:"channel_name",rules:[{required:!0,message:e["channelName.required"]}],children:a(b,{maxLength:100,showWordLimit:!0,placeholder:e["channelName.placeholder"]})}),a(d.Item,{label:e.sourceCode,field:"source_code",rules:[{required:!0,message:e["sourceCode.required"]}],children:a(b,{maxLength:80,showWordLimit:!0,placeholder:e["sourceCode.placeholder"]})}),a(d.Item,{label:e.channelType,field:"channel_type",rules:[{required:!0,message:e["channelType.required"]}],initialValue:"OTHER",children:a(E,{options:t.type})}),a(d.Item,{label:e.description,field:"description",wrapperCol:{span:22},children:a(M,{maxLength:200,placeholder:e["description.placeholder"],showWordLimit:!0,autoSize:!0,style:{minHeight:64}})})]})})}async function U(t){if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(t);return}catch(o){console.error(o)}const e=document.createElement("span");e.textContent=t,document.body.appendChild(e);const n=document.createRange();n.selectNode(e),window.getSelection().addRange(n),document.execCommand("copy"),window.getSelection().removeAllRanges(),document.body.removeChild(e)}function re(){const t=g(D),e=g(v),n=h.exports.useRef(),[o,f]=h.exports.useState([]),[u,l]=_({visible:!1,close:function(){l(c=>{c.visible=!1})}});async function C(c){try{const r=await R({uuid:c});r.code===0&&l(i=>{i.data=r.data,i.visible=!0})}catch{}}h.exports.useEffect(()=>{$().then(c=>{const r=Object.entries(c.data.list).map(([i,F])=>({label:F,value:i}));f(r)})},[]);const y=[{title:"ID",width:80,dataIndex:"id"},{title:e.channelName,dataIndex:"channel_name",search:!0},{title:e.sourceCode,dataIndex:"source_code",search:!0},{title:e.channelType,dataIndex:"channel_type",valueType:"select",fieldProps:{options:o},render(c,r){const i=o.find(F=>F.value===r.channel_type);return i?i.label:""},search:!0},{title:e.description,dataIndex:"description",ellipsis:!0},{title:e.updateAt,dataIndex:"updated_at"},{title:e.action,width:300,render:(c,r)=>p(L,{children:[p(s,{type:"text",onClick:()=>C(r.uuid),children:[a(T,{}),e.edit]}),p(s,{type:"text",onClick:()=>{const i=`${window.location.origin}?traffic_source=${r.source_code}`;U(i),q.success(e.copySuccess)},children:[a(w,{}),e.copyLink]}),a(N,{reqDel:W,params:{uuid:r.uuid},reload:()=>n.current.reload(),children:p(s,{type:"text",children:[a(A,{}),e.delete]})})]})}];return p(k,{children:[u.visible&&a(O,{visible:u.visible,data:u.data,close:()=>u.close(),reload:()=>n.current.reload(),type:o}),a(x,{style:{display:u.visible?"none":void 0},children:a(I,{ref:n,request:P,columns:y,actionBarRender:[a(s,{type:"primary",onClick:()=>n.current.reload(),children:t["table.refresh"]},"refresh")],toolBarRender:[a(s,{type:"primary",onClick:()=>{l(c=>{c.visible=!0,c.data=void 0})},children:t["table.create"]},"create")]})})]})}export{re as default};
