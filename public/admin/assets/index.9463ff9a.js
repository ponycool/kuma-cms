import{h as f,aj as h,aB as s,r as g,j as a,K as w,B as d,a as p,M as b,u as y,i as F,bc as x,F as I}from"./index.bbe790dc.js";import{U as v}from"./index.79019515.js";import{C}from"./index.7f78f3d8.js";import{D,P as k}from"./index.a63bf2ab.js";import{i as E,C as B,D as L}from"./use-immer.module.e35981bc.js";import"./index.57a7c61a.js";import{c as _}from"./convertNullToUndefined.a19d8223.js";import{f as j}from"./formatDate.c584a859.js";import{i as A}from"./index.4a144940.js";import{I as T}from"./image.12fe54b4.js";import{I as q}from"./index.3a3a7e0d.js";import"./index.6bec4a3a.js";import"./index.a130295f.js";import"./index.e923ab7c.js";function z(e){return f.post("/api/honor/query",e)}function P(e){return f.post("/api/honor/detail",e)}function S(e){return f.post("/api/honor/create",e)}function H(e){return f.post("/api/honor/update",e)}function N(e){return f.post("/api/honor/delete",e)}const R=h.TextArea;function U(e){const[i]=s.useForm(),[u,n]=g.exports.useState(!1);async function c(){i.validate().then(async t=>{n(!0);try{const l={...t,image:t.image&&t.image.length!==0?t.image[0].response.data.name:void 0};let r;e.data?r=await H({...l,uuid:e.data.uuid}):r=await S(l),r.code===0&&(e.reload(),e.close())}finally{n(!1)}}).catch(t=>{if(t.errors)for(const l in t.errors)b.error(t.errors[l].message)})}return g.exports.useEffect(()=>{if(e.data){const t=_(e.data),l=t.image;i.setFieldsValue({...t,image:t.image?[{uid:t.image,url:l,response:{data:{name:t.image.replace("/media/image?n=",""),path:t.image}}}]:[],award_date:t.award_date?j(new Date(t.award_date)):void 0})}},[e.data]),g.exports.useEffect(()=>{e.visible===!1&&i.resetFields()},[i,e.visible]),a(C,{title:e.data?"\u4FEE\u6539\u8363\u8A89":"\u521B\u5EFA\u8363\u8A89",extra:a(w,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>e.close()}),actions:[a(d,{type:"default",onClick:()=>e.close(),children:"\u53D6\u6D88"},"cancel"),a(d,{type:"primary",loading:u,onClick:c,children:e.data?"\u4FDD\u5B58":"\u521B\u5EFA"},"submit")],children:p(s,{form:i,labelCol:{span:2},wrapperCol:{span:22},children:[a(s.Item,{label:"\u6807\u9898",field:"title",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898"}],children:a(h,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u6807\u9898"})}),a(s.Item,{label:"\u56FE\u7247",field:"image",triggerPropName:"fileList",children:a(v,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),a(s.Item,{label:"\u9881\u53D1\u7EC4\u7EC7",field:"award_organization",wrapperCol:{span:2},children:a(h,{maxLength:100,placeholder:"\u9881\u53D1\u7EC4\u7EC7"})}),a(s.Item,{label:"\u9881\u53D1\u65F6\u95F4",field:"award_date",wrapperCol:{span:2},children:a(D,{})}),a(s.Item,{label:"\u63CF\u8FF0",field:"description",children:a(R,{maxLength:200,placeholder:"\u63CF\u8FF0",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})})]})})}function te(){const e=y(F),i=y(A),u=g.exports.useRef(),[n,c]=E({visible:!1,close:function(){c(r=>{r.visible=!1})}});async function t(r){try{const o=await P({uuid:r});o.code===0&&c(m=>{m.data=o.data,m.visible=!0})}catch{}}const l=[{title:i["columns.keyword"],dataIndex:"keyword",search:!0,hide:!0},{title:i["columns.title"],dataIndex:"title",ellipsis:!0},{title:i["columns.image"],width:150,dataIndex:"image",render:(r,o)=>{if(o.image){let m="";return m=o.image,a(T,{width:40,height:40,src:m})}else return i["columns.noImage"]}},{title:i["columns.awardOrganization"],dataIndex:"award_organization"},{title:i["columns.awardDate"],dataIndex:"award_date"},{title:i["columns.action"],width:280,render:(r,o)=>p(B,{children:[p(d,{type:"text",onClick:()=>t(o.uuid),children:[a(x,{}),i["columns.action.edit"]]}),a(L,{reqDel:N,params:{uuid:o.uuid},reload:()=>u.current.reload(),children:p(d,{type:"text",children:[a(q,{}),i["columns.action.delete"]]})})]})}];return p(I,{children:[n.visible&&a(U,{visible:n.visible,data:n.data,close:()=>n.close(),reload:()=>u.current.reload()}),a(C,{style:{display:n.visible?"none":void 0},children:a(k,{ref:u,request:z,columns:l,actionBarRender:[a(d,{type:"primary",onClick:()=>u.current.reload(),children:e["table.refresh"]},"refresh")],toolBarRender:[a(d,{type:"primary",onClick:()=>{c(r=>{r.visible=!0,r.data=void 0})},children:e["table.addHonors"]},"create")]})})]})}export{te as default};
