import{h as m,aj as v,u as h,av as c,r as p,j as r,K as x,B as d,a as u,M as I,i as w,bc as k,F as D}from"./index.4c1d9a77.js";import{U as L}from"./index.60d7899b.js";import{C}from"./index.a3c7e22f.js";import{A as b,P as q}from"./index.8cb05232.js";import{C as E,D as _}from"./DelPopconfirm.2173276f.js";import{D as j}from"./index.725a27de.js";import"./index.4b5bde6d.js";import"./index.dd410d34.js";import{c as F}from"./convertNullToUndefined.a19d8223.js";import{f as T}from"./formatDate.c584a859.js";import{i as y}from"./index.068ea4bb.js";import{i as B}from"./use-immer.module.3e4f1e58.js";import{I as P}from"./image.e242b103.js";import{I as S}from"./index.95b8c859.js";import"./index.f63ae92b.js";import"./index.63498f9e.js";import"./index.f69144bb.js";import"./index.48808231.js";import"./b-tween.es.064e2a03.js";import"./index.48cfa5be.js";function A(t){return m.post("/api/event/query",t)}function N(t){return m.post("/api/event/detail",t)}function R(t){return m.post("/api/event/create",t)}function U(t){return m.post("/api/event/update",t)}function z(t){return m.post("/api/event/delete",t)}function M(){return m.post("/api/event/group/query")}const O=v.TextArea,{Option:W}=b;function G(t){var f;const a=h(y),[o]=c.useForm(),[l,s]=p.exports.useState(!1);async function g(){o.validate().then(async e=>{s(!0);try{const i={...e,image:e.image&&e.image.length!==0?e.image[0].response.data.name:void 0};let n;t.data?n=await U({...i,uuid:t.data.uuid}):n=await R(i),n.code===0&&(t.reload(),t.close())}finally{s(!1)}}).catch(e=>{if(e.errors)for(const i in e.errors)I.error(e.errors[i].message)})}return p.exports.useEffect(()=>{if(t.data){const e=F(t.data),i=e.image;o.setFieldsValue({...e,image:e.image?[{uid:e.image,url:i,response:{data:{name:e.image.replace("/media/image?n=",""),path:e.image}}}]:[],event_date:e.event_date?T(new Date(e.event_date)):void 0})}},[t.data]),p.exports.useEffect(()=>{t.visible===!1&&o.resetFields()},[o,t.visible]),r(C,{title:t.data?a["eventCreate.title.update"]:a["eventCreate.title.create"],extra:r(x,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>t.close()}),actions:[r(d,{type:"default",onClick:()=>t.close(),children:a["eventCreate.button.cancel"]},"cancel"),r(d,{type:"primary",loading:l,onClick:g,children:t.data?a["eventCreate.button.save"]:a["eventCreate.button.create"]},"submit")],children:u(c,{form:o,labelCol:{span:2},wrapperCol:{span:22},children:[r(c.Item,{label:a["eventCreate.form.title.label"],field:"title",rules:[{required:!0,message:a["eventCreate.form.title.required"]}],children:r(v,{maxLength:100,showWordLimit:!0,placeholder:a["eventCreate.form.title.placeholder"]})}),r(c.Item,{label:a["eventCreate.form.image.label"],field:"image",triggerPropName:"fileList",children:r(L,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),r(c.Item,{label:a["eventCreate.form.group.label"],field:"group",wrapperCol:{span:2},children:r(b,{placeholder:a["eventCreate.form.group.placeholder"],children:(f=t.group)==null?void 0:f.map(e=>r(W,{value:e,children:e},e))})}),r(c.Item,{label:a["eventCreate.form.date.label"],field:"event_date",wrapperCol:{span:2},children:r(j,{placeholder:a["eventCreate.form.date.placeholder"]})}),r(c.Item,{label:a["eventCreate.form.description.label"],field:"description",children:r(O,{maxLength:200,placeholder:a["eventCreate.form.description.placeholder"],showWordLimit:!0,autoSize:!0,style:{minHeight:64}})})]})})}function me(){const t=h(w),a=h(y),o=p.exports.useRef(),[l,s]=B({visible:!1,close:function(){s(e=>{e.visible=!1})},group:[]});p.exports.useEffect(()=>{M().then(e=>{e.code===0&&s(i=>{i.group=e.data||[]})})},[]);async function g(e){try{const i=await N({uuid:e});i.code===0&&s(n=>{n.data=i.data,n.visible=!0})}catch{}}const f=[{title:a["columns.keyword"],dataIndex:"keyword",search:!0,hide:!0},{title:a["columns.title"],dataIndex:"title",ellipsis:!0},{title:a["columns.image"],width:150,dataIndex:"image",render:(e,i)=>{if(i.image){let n="";return n=i.image,r(P,{width:40,height:40,src:n})}else return a["columns.noImage"]}},{title:a["columns.group"],dataIndex:"group"},{title:a["columns.eventDate"],dataIndex:"event_date"},{title:a["columns.action"],width:280,render:(e,i)=>u(E,{children:[u(d,{type:"text",onClick:()=>g(i.uuid),children:[r(k,{}),a["columns.action.edit"]]}),r(_,{reqDel:z,params:{uuid:i.uuid},reload:()=>o.current.reload(),children:u(d,{type:"text",children:[r(S,{}),a["columns.action.delete"]]})})]})}];return u(D,{children:[l.visible&&r(G,{visible:l.visible,data:l.data,close:()=>l.close(),reload:()=>o.current.reload(),group:l.group}),r(C,{style:{display:l.visible?"none":void 0},children:r(q,{ref:o,request:A,columns:f,actionBarRender:[r(d,{type:"primary",onClick:()=>o.current.reload(),children:t["table.refresh"]},"refresh")],toolBarRender:[r(d,{type:"primary",onClick:()=>{s(e=>{e.visible=!0,e.data=void 0})},children:t["table.createEvent"]},"create")]})})]})}export{me as default};
