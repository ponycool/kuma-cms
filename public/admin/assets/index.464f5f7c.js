import{u as b,au as f,r as p,j as t,bk as F,a as h,aj as I,av as k,ay as R,M as j,i as E,B as C,bj as L}from"./index.ebe80f86.js";import{C as M}from"./index.5e2f8594.js";import{T as O,P as S}from"./index.b3429c1e.js";import{i as w,c as V,a as q,b as B,d as T}from"./index.6945d95a.js";import{C as G,D as _}from"./DelPopconfirm.8637c465.js";import{i as D}from"./use-immer.module.5d332cb7.js";import{I as N}from"./index.fa3d1f74.js";import{I as P}from"./index.1c0460b5.js";import"./index.bb775d25.js";import"./index.567ccee7.js";import"./b-tween.es.064e2a03.js";import"./index.e89cd15a.js";import"./index.84a41917.js";import"./index.e0ea0491.js";import"./index.978cbd4d.js";import"./scrollIntoView.d5893045.js";const{Row:z,Col:v}=R;function A(e){const a=b(w),[r]=f.useForm(),[n,c]=p.exports.useState(!1),[g,u]=p.exports.useState(1);p.exports.useEffect(()=>(e.level&&u(e.level+1),()=>{u(1)}),[e.level]),p.exports.useEffect(()=>{e.data?(r.setFieldsValue(e.data),r.setFieldValue("pid",e.data.pid)):e.id&&r.setFieldValue("pid",e.id),e.visible||r.resetFields()},[r,e.data,e.visible]);async function y(){r.validate().then(async i=>{var o;c(!0);let l;e.uuid?l=await V({...i,uuid:e.uuid,pid:i.pid,level:g,sortIndex:i.sortIndex||1}):l=await q({...i,sortIndex:i.sortIndex||1,pid:(o=i.pid)!=null?o:0,level:g}),l.code===0&&(j.success(l.message),e.reload(),e.close(),r.resetFields())}).catch(i=>{}).finally(()=>{c(!1)})}return t(F,{width:400,title:e.uuid?a["categoryCreate.title.update"]:a["categoryCreate.title.create"],visible:e.visible,onOk:y,onCancel:e.close,confirmLoading:n,okText:e.uuid?a["categoryCreate.button.save"]:a["categoryCreate.button.create"],children:t(f,{form:r,children:h(z,{children:[t(v,{span:24,children:t(f.Item,{label:a["categoryCreate.form.name.label"],field:"name",rules:[{required:!0,message:!0}],labelCol:{span:6},wrapperCol:{span:18},children:t(I,{type:"text",placeholder:a["categoryCreate.form.name.placeholder"]})})}),t(v,{span:24,children:t(f.Item,{label:a["categoryCreate.form.pid.label"],field:"pid",labelCol:{span:6},wrapperCol:{span:18},rules:[{validator(i,l){e.data&&i===e.data.id&&l(a["categoryCreate.form.pid.error"]),l()}}],children:t(O,{treeData:e.pidOptions,fieldNames:{key:"id",title:"name"},placeholder:a["categoryCreate.form.pid.placeholder"],onChange:(i,l)=>{Object.keys(l).length===0?(u(1),r.setFieldValue("pid",0)):(u(l.trigger.dataRef.level+1),r.setFieldValue("pid",l.trigger.dataRef.id))},allowClear:!0})})}),t(v,{span:24,children:t(f.Item,{label:a["categoryCreate.form.code.label"],field:"code",labelCol:{span:6},wrapperCol:{span:18},children:t(I,{type:"text",placeholder:a["categoryCreate.form.code.placeholder"]})})}),t(v,{span:24,children:t(f.Item,{label:a["categoryCreate.form.sortIndex.label"],field:"sortIndex",labelCol:{span:6},wrapperCol:{span:18},initialValue:1,rules:[{validator(i,l){i&&i<1?l(a["categoryCreate.form.sortIndex.error"]):l()}}],children:t(k,{placeholder:a["categoryCreate.form.sortIndex.placeholder"]})})})]})})})}function oe(){const e=b(E),a=b(w),r=p.exports.useRef(),[n,c]=D({visible:!1,close:()=>{c(o=>{o.visible=!1})}}),[g,u]=p.exports.useState(),[y]=D({reqDel:B});function i(o){const d=new Map,s=[];return o.forEach(m=>d.set(m.id,{...m,children:[]})),o.forEach(m=>{const x=d.get(m.pid);x?x.children.push(d.get(m.id)):s.push(d.get(m.id))}),s}p.exports.useEffect(()=>{c(o=>{o.pidOptions=r.current.getList()})},[r.current]);const l=[{title:a["columns.name"],dataIndex:"name"},{title:a["columns.action"],key:"option",render:(o,d)=>h(G,{children:[h(C,{type:"text",onClick:()=>{c(s=>{s.id=d.id,s.level=d.level,s.uuid=void 0,s.visible=!0}),u(void 0)},children:[t(N,{}),a["columns.action.create"]]}),h(C,{type:"text",onClick:()=>{c(s=>{s.id=void 0,s.level=void 0,s.uuid=d.uuid,s.visible=!0}),u({name:d.name,code:d.code,sortIndex:d.sort_index,pid:d.pid,id:d.id})},children:[t(L,{}),a["columns.action.edit"]]}),t(_,{reqDel:y.reqDel,params:{uuid:d.uuid},reload:()=>r.current.reload(),children:h(C,{type:"text",children:[t(P,{}),a["columns.action.delete"]]})})]})}];return h(M,{children:[t(A,{data:g,visible:n.visible,id:n.id,level:n.level,uuid:n.uuid,close:n.close,reload:()=>r.current.reload(),pidOptions:n.pidOptions}),t(S,{ref:r,request:T,dataRender:i,columns:l,pagination:!1,pageSize:!1,actionBarRender:[t(C,{type:"primary",onClick:()=>r.current.reload(),children:e["table.refresh"]},"refresh")],toolBarRender:[t(C,{type:"primary",onClick:()=>{c(o=>{o.id=void 0,o.visible=!0,o.uuid=void 0,o.level=void 0}),u(void 0)},children:e["table.createCategory"]},"create")]})]})}export{oe as default};
