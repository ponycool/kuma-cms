import{h as d,aj as v,aB as l,r as f,j as t,K as C,B as c,a as p,M as b,u as h,i as x,bc as E,F as I}from"./index.bbe790dc.js";import{U as w}from"./index.79019515.js";import{C as y}from"./index.7f78f3d8.js";import{A as F,D as k,P as B}from"./index.a63bf2ab.js";import{i as D,C as L,D as _}from"./use-immer.module.e35981bc.js";import"./index.57a7c61a.js";import{c as j}from"./convertNullToUndefined.a19d8223.js";import{f as q}from"./formatDate.c584a859.js";import{i as A}from"./index.4a144940.js";import{I as T}from"./image.12fe54b4.js";import{I as P}from"./index.3a3a7e0d.js";import"./index.6bec4a3a.js";import"./index.a130295f.js";import"./index.e923ab7c.js";function S(e){return d.post("/api/event/query",e)}function N(e){return d.post("/api/event/detail",e)}function R(e){return d.post("/api/event/create",e)}function U(e){return d.post("/api/event/update",e)}function z(e){return d.post("/api/event/delete",e)}function M(){return d.post("/api/event/group/query")}const O=v.TextArea,{Option:W}=F;function G(e){var g;const[r]=l.useForm(),[u,o]=f.exports.useState(!1);async function s(){r.validate().then(async a=>{o(!0);try{const i={...a,image:a.image&&a.image.length!==0?a.image[0].response.data.name:void 0};let n;e.data?n=await U({...i,uuid:e.data.uuid}):n=await R(i),n.code===0&&(e.reload(),e.close())}finally{o(!1)}}).catch(a=>{if(a.errors)for(const i in a.errors)b.error(a.errors[i].message)})}return f.exports.useEffect(()=>{if(e.data){const a=j(e.data),i=a.image;r.setFieldsValue({...a,image:a.image?[{uid:a.image,url:i,response:{data:{name:a.image.replace("/media/image?n=",""),path:a.image}}}]:[],event_date:a.event_date?q(new Date(a.event_date)):void 0})}},[e.data]),f.exports.useEffect(()=>{e.visible===!1&&r.resetFields()},[r,e.visible]),t(y,{title:e.data?"\u4FEE\u6539\u4E8B\u4EF6":"\u521B\u5EFA\u4E8B\u4EF6",extra:t(C,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>e.close()}),actions:[t(c,{type:"default",onClick:()=>e.close(),children:"\u53D6\u6D88"},"cancel"),t(c,{type:"primary",loading:u,onClick:s,children:e.data?"\u4FDD\u5B58":"\u521B\u5EFA"},"submit")],children:p(l,{form:r,labelCol:{span:2},wrapperCol:{span:22},children:[t(l.Item,{label:"\u6807\u9898",field:"title",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898"}],children:t(v,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u6807\u9898"})}),t(l.Item,{label:"\u56FE\u7247",field:"image",triggerPropName:"fileList",children:t(w,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),t(l.Item,{label:"\u5206\u7EC4",field:"group",wrapperCol:{span:2},children:t(F,{placeholder:"\u9009\u62E9\u5206\u7EC4",children:(g=e.group)==null?void 0:g.map(a=>t(W,{value:a,children:a},a))})}),t(l.Item,{label:"\u65F6\u95F4",field:"event_date",wrapperCol:{span:2},children:t(k,{})}),t(l.Item,{label:"\u63CF\u8FF0",field:"description",children:t(O,{maxLength:200,placeholder:"\u63CF\u8FF0",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})})]})})}function ne(){const e=h(x),r=h(A),u=f.exports.useRef(),[o,s]=D({visible:!1,close:function(){s(i=>{i.visible=!1})},group:[]});f.exports.useEffect(()=>{M().then(i=>{i.code===0&&s(n=>{n.group=i.data||[]})})},[]);async function g(i){try{const n=await N({uuid:i});n.code===0&&s(m=>{m.data=n.data,m.visible=!0})}catch{}}const a=[{title:r["columns.keyword"],dataIndex:"keyword",search:!0,hide:!0},{title:r["columns.title"],dataIndex:"title",ellipsis:!0},{title:r["columns.image"],width:150,dataIndex:"image",render:(i,n)=>{if(n.image){let m="";return m=n.image,t(T,{width:40,height:40,src:m})}else return r["columns.noImage"]}},{title:r["columns.group"],dataIndex:"group"},{title:r["columns.eventDate"],dataIndex:"event_date"},{title:r["columns.action"],width:280,render:(i,n)=>p(L,{children:[p(c,{type:"text",onClick:()=>g(n.uuid),children:[t(E,{}),r["columns.action.edit"]]}),t(_,{reqDel:z,params:{uuid:n.uuid},reload:()=>u.current.reload(),children:p(c,{type:"text",children:[t(P,{}),r["columns.action.delete"]]})})]})}];return p(I,{children:[o.visible&&t(G,{visible:o.visible,data:o.data,close:()=>o.close(),reload:()=>u.current.reload(),group:o.group}),t(y,{style:{display:o.visible?"none":void 0},children:t(B,{ref:u,request:S,columns:a,actionBarRender:[t(c,{type:"primary",onClick:()=>u.current.reload(),children:e["table.refresh"]},"refresh")],toolBarRender:[t(c,{type:"primary",onClick:()=>{s(i=>{i.visible=!0,i.data=void 0})},children:e["table.createEvent"]},"create")]})})]})}export{ne as default};
