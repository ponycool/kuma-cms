import{h as d,aj as v,av as l,r as f,j as t,K as C,B as c,a as p,M as b,u as h,i as x,bc as E,F as I}from"./index.887e1024.js";import{U as w}from"./index.1a867338.js";import{C as y}from"./index.cadb19cf.js";import{A as F,P as k}from"./index.883a7c69.js";import{C as B,D}from"./DelPopconfirm.7ebf1063.js";import{D as L}from"./index.bf686981.js";import"./index.55eedb13.js";import{c as _}from"./convertNullToUndefined.a19d8223.js";import{f as j}from"./formatDate.c584a859.js";import{i as q}from"./use-immer.module.babe411d.js";import{i as A}from"./index.4a144940.js";import{I as T}from"./image.4e5135d7.js";import{I as P}from"./index.b35c3ab1.js";import"./index.a8c91ad8.js";import"./index.bf4e9e68.js";import"./index.ebf1d748.js";import"./index.e51fe832.js";import"./b-tween.es.064e2a03.js";function S(e){return d.post("/api/event/query",e)}function N(e){return d.post("/api/event/detail",e)}function R(e){return d.post("/api/event/create",e)}function U(e){return d.post("/api/event/update",e)}function z(e){return d.post("/api/event/delete",e)}function M(){return d.post("/api/event/group/query")}const O=v.TextArea,{Option:W}=F;function G(e){var g;const[r]=l.useForm(),[u,n]=f.exports.useState(!1);async function s(){r.validate().then(async a=>{n(!0);try{const i={...a,image:a.image&&a.image.length!==0?a.image[0].response.data.name:void 0};let o;e.data?o=await U({...i,uuid:e.data.uuid}):o=await R(i),o.code===0&&(e.reload(),e.close())}finally{n(!1)}}).catch(a=>{if(a.errors)for(const i in a.errors)b.error(a.errors[i].message)})}return f.exports.useEffect(()=>{if(e.data){const a=_(e.data),i=a.image;r.setFieldsValue({...a,image:a.image?[{uid:a.image,url:i,response:{data:{name:a.image.replace("/media/image?n=",""),path:a.image}}}]:[],event_date:a.event_date?j(new Date(a.event_date)):void 0})}},[e.data]),f.exports.useEffect(()=>{e.visible===!1&&r.resetFields()},[r,e.visible]),t(y,{title:e.data?"\u4FEE\u6539\u4E8B\u4EF6":"\u521B\u5EFA\u4E8B\u4EF6",extra:t(C,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>e.close()}),actions:[t(c,{type:"default",onClick:()=>e.close(),children:"\u53D6\u6D88"},"cancel"),t(c,{type:"primary",loading:u,onClick:s,children:e.data?"\u4FDD\u5B58":"\u521B\u5EFA"},"submit")],children:p(l,{form:r,labelCol:{span:2},wrapperCol:{span:22},children:[t(l.Item,{label:"\u6807\u9898",field:"title",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898"}],children:t(v,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u6807\u9898"})}),t(l.Item,{label:"\u56FE\u7247",field:"image",triggerPropName:"fileList",children:t(w,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),t(l.Item,{label:"\u5206\u7EC4",field:"group",wrapperCol:{span:2},children:t(F,{placeholder:"\u9009\u62E9\u5206\u7EC4",children:(g=e.group)==null?void 0:g.map(a=>t(W,{value:a,children:a},a))})}),t(l.Item,{label:"\u65F6\u95F4",field:"event_date",wrapperCol:{span:2},children:t(L,{})}),t(l.Item,{label:"\u63CF\u8FF0",field:"description",children:t(O,{maxLength:200,placeholder:"\u63CF\u8FF0",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})})]})})}function se(){const e=h(x),r=h(A),u=f.exports.useRef(),[n,s]=q({visible:!1,close:function(){s(i=>{i.visible=!1})},group:[]});f.exports.useEffect(()=>{M().then(i=>{i.code===0&&s(o=>{o.group=i.data||[]})})},[]);async function g(i){try{const o=await N({uuid:i});o.code===0&&s(m=>{m.data=o.data,m.visible=!0})}catch{}}const a=[{title:r["columns.keyword"],dataIndex:"keyword",search:!0,hide:!0},{title:r["columns.title"],dataIndex:"title",ellipsis:!0},{title:r["columns.image"],width:150,dataIndex:"image",render:(i,o)=>{if(o.image){let m="";return m=o.image,t(T,{width:40,height:40,src:m})}else return r["columns.noImage"]}},{title:r["columns.group"],dataIndex:"group"},{title:r["columns.eventDate"],dataIndex:"event_date"},{title:r["columns.action"],width:280,render:(i,o)=>p(B,{children:[p(c,{type:"text",onClick:()=>g(o.uuid),children:[t(E,{}),r["columns.action.edit"]]}),t(D,{reqDel:z,params:{uuid:o.uuid},reload:()=>u.current.reload(),children:p(c,{type:"text",children:[t(P,{}),r["columns.action.delete"]]})})]})}];return p(I,{children:[n.visible&&t(G,{visible:n.visible,data:n.data,close:()=>n.close(),reload:()=>u.current.reload(),group:n.group}),t(y,{style:{display:n.visible?"none":void 0},children:t(k,{ref:u,request:S,columns:a,actionBarRender:[t(c,{type:"primary",onClick:()=>u.current.reload(),children:e["table.refresh"]},"refresh")],toolBarRender:[t(c,{type:"primary",onClick:()=>{s(i=>{i.visible=!0,i.data=void 0})},children:e["table.createEvent"]},"create")]})})]})}export{se as default};
