import{R as B,r as g,g as T,j as t,_ as R,aj as x,u as O,av as m,F,a as y,K as q,B as C,aw as V,am as K,bb as U,M as z,i as H,aR as P,bc as Z}from"./index.d59523fc.js";import{U as G}from"./index.4b887ea4.js";import{C as A}from"./index.b3970201.js";import{T as J,P as Q}from"./index.235ddbc2.js";import{i as W,c as M,a as X,b as Y,d as ee,e as te,f as re,g as ae,h as ie}from"./index.f4ca4d5b.js";import{C as oe,D as le}from"./DelPopconfirm.5aadda0d.js";import"./index.40ab9e28.js";import{M as ne}from"./index.58792bb0.js";import{c as S}from"./convertNullToUndefined.a19d8223.js";import{i as ce}from"./use-immer.module.3010fc4a.js";import{I as se}from"./image.349ca6c0.js";import{I as de}from"./index.b978ac62.js";import"./index.32238308.js";import"./index.1f5227c0.js";import"./index.885164d7.js";import"./index.12a319b6.js";import"./b-tween.es.064e2a03.js";import"./index.78be01c8.js";import"./index.bd5e3e31.js";import"./index.8275f6d3.js";function k(r,e){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),a.push.apply(a,i)}return a}function L(r){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?k(Object(a),!0).forEach(function(i){R(r,i,a[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):k(Object(a)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(a,i))})}return r}function ue(r,e){var a=g.exports.useContext(T),i=a.prefixCls,n=i===void 0?"arco":i,p=r.spin,f=r.className,d=L(L({"aria-hidden":!0,focusable:!1,ref:e},r),{},{className:"".concat(f?f+" ":"").concat(n,"-icon ").concat(n,"-icon-reply")});return p&&(d.className="".concat(d.className," ").concat(n,"-icon-loading")),delete d.spin,delete d.isIcon,t("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...d,children:t("path",{d:"m6.642 24.684 14.012 14.947a.2.2 0 0 0 .346-.137v-8.949A23.077 23.077 0 0 1 26 30c6.208 0 11.84 2.459 15.978 6.456a.01.01 0 0 0 .017-.007C42 36.299 42 36.15 42 36c0-10.493-8.506-19-19-19-.675 0-1.342.035-2 .104V8.506a.2.2 0 0 0-.346-.137L6.642 23.316a1 1 0 0 0 0 1.368Z"})})}var j=B.forwardRef(ue);j.defaultProps={isIcon:!0};j.displayName="IconReply";var me=j;function N(r,e){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),a.push.apply(a,i)}return a}function E(r){for(var e=1;e<arguments.length;e++){var a=arguments[e]!=null?arguments[e]:{};e%2?N(Object(a),!0).forEach(function(i){R(r,i,a[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):N(Object(a)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(a,i))})}return r}function pe(r,e){var a=g.exports.useContext(T),i=a.prefixCls,n=i===void 0?"arco":i,p=r.spin,f=r.className,d=E(E({"aria-hidden":!0,focusable:!1,ref:e},r),{},{className:"".concat(f?f+" ":"").concat(n,"-icon ").concat(n,"-icon-send")});return p&&(d.className="".concat(d.className," ").concat(n,"-icon-loading")),delete d.spin,delete d.isIcon,t("svg",{fill:"none",stroke:"currentColor",strokeWidth:"4",viewBox:"0 0 48 48",...d,children:t("path",{strokeMiterlimit:"3.864",d:"m14 24-7-5V7l34 17L7 41V29l7-5Zm0 0h25"})})}var D=B.forwardRef(pe);D.defaultProps={isIcon:!0};D.displayName="IconSend";var fe=D;const _=x.TextArea;function he(r){const e=O(W),[a]=m.useForm(),[i,n]=g.exports.useState(""),[p,f]=g.exports.useState(!1),[d,w]=g.exports.useState([]);async function I(){try{const o=await M();if(o.code===0){const l=o.data,h=new Map,v=[];l.forEach(s=>h.set(s.id,{...s,children:[]})),l.forEach(s=>{const b=h.get(s.pid);b?b.children.push(h.get(s.id)):v.push(h.get(s.id))}),w(v)}}catch{}}function u(o){n(o)}async function c(){a.validate().then(async o=>{const l=S(o);try{if(!i||i==="<p><br></p>")throw z.error("\u8BF7\u586B\u5199\u6587\u7AE0\u5185\u5BB9"),new Error("\u8BF7\u586B\u5199\u6587\u7AE0\u5185\u5BB9");const h={...l,cover_image:l.cover_image&&l.cover_image.length!==0?l.cover_image[0].response.data.name:void 0,is_published:l.is_published?"true":"false",content:i,sort_index:l.sort_index||1};let v;r.data?v=await X({...h,uuid:r.data.uuid}):v=await Y(h),v.code===0&&(r.reload(),r.close())}finally{f(!1)}}).catch(o=>{console.log(o),console.error("\u4FE1\u606F\u4E0D\u5B8C\u6574")})}return g.exports.useEffect(()=>{I()},[]),g.exports.useEffect(()=>{if(r.data){const o=S(r.data);let l="";l=o.cover_image,a.setFieldsValue({...o,status:o.is_published===1,cover_image:o.cover_image?[{uid:o.cover_image,url:l,response:{data:{name:o.cover_image.replace("/media/image?n=",""),path:o.cover_image}}}]:[]}),n(o.content)}},[r.data]),g.exports.useEffect(()=>{r.visible===!1&&(a.resetFields(),n(void 0))},[a,r.visible]),t(F,{children:y(A,{title:r.data?e["articleCreate.title.update"]:e["articleCreate.title.create"],extra:t(q,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>r.close()}),actions:[t(C,{type:"default",onClick:()=>r.close(),children:e["articleCreate.button.cancel"]},"cancel"),t(C,{type:"primary",loading:p,onClick:c,children:r.data?e["articleCreate.button.save"]:e["articleCreate.button.create"]},"submit")],children:[y(m,{form:a,labelCol:{span:2},wrapperCol:{span:22},children:[t(m.Item,{label:e["articleCreate.form.title.label"],field:"title",rules:[{required:!0,message:e["articleCreate.form.title.required"]}],children:t(x,{maxLength:100,showWordLimit:!0,placeholder:e["articleCreate.form.title.placeholder"]})}),t(m.Item,{label:e["articleCreate.form.category.label"],field:"cid",rules:[{required:!0,message:e["articleCreate.form.category.required"]}],wrapperCol:{span:2},children:t(J,{treeData:d,fieldNames:{key:"id",title:"name"},allowClear:!0})}),t(m.Item,{label:e["articleCreate.form.coverImage.label"],field:"cover_image",triggerPropName:"fileList",children:t(G,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),t(m.Item,{label:e["articleCreate.form.author.label"],field:"author",wrapperCol:{span:2},children:t(x,{maxLength:50,showWordLimit:!0,placeholder:e["articleCreate.form.author.placeholder"]})}),t(m.Item,{label:e["articleCreate.form.seoTitle.label"],field:"seo_title",children:t(x,{maxLength:200,showWordLimit:!0,placeholder:e["articleCreate.form.seoTitle.placeholder"]})}),t(m.Item,{label:e["articleCreate.form.seoDesc.label"],field:"seo_desc",children:t(_,{maxLength:200,placeholder:e["articleCreate.form.seoDesc.placeholder"],showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),t(m.Item,{label:e["articleCreate.form.seoKeywords.label"],field:"seo_keywords",children:t(_,{maxLength:200,placeholder:e["articleCreate.form.seoKeywords.placeholder"],showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),t(m.Item,{label:e["articleCreate.form.summary.label"],field:"summary",children:t(_,{maxLength:200,placeholder:e["articleCreate.form.summary.placeholder"],showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),t(m.Item,{label:e["articleCreate.form.sortIndex.label"],field:"sort_index",wrapperCol:{span:2},initialValue:1,rules:[{validator(o,l){o&&o<1?l(e["articleCreate.form.sortIndex.error"]):l()}}],children:t(V,{maxLength:10,hideControl:!0,placeholder:e["articleCreate.form.sortIndex.placeholder"]})}),t(m.Item,{label:e["articleCreate.form.isPublished.label"],field:"is_published",triggerPropName:"checked",initialValue:!1,children:t(K,{})})]}),t(U,{orientation:"left",children:e["articleCreate.form.content.label"]}),t(ne,{html:i,getContent:u})]})})}function Re(){const r=O(H),e=O(W),a=g.exports.useRef(),[i,n]=g.exports.useState([]),[p,f]=ce({visible:!1,close:function(){f(u=>{u.visible=!1})}});async function d(u){const o=(await M()).data,l=new Map,h=[];return o.forEach(s=>l.set(s.id,{...s,children:[]})),o.forEach(s=>{const b=l.get(s.pid);b?b.children.push(l.get(s.id)):h.push(l.get(s.id))}),n(h),u.map(s=>{const b=o.find($=>$.id===s.cid);return{...s,category:b?b.name:null}})}async function w(u){try{const c=await ie({uuid:u});c.code===0&&f(o=>{o.data=c.data,o.visible=!0})}catch{}}const I=[{title:e["columns.category"],dataIndex:"cid",search:!0,hide:!0,valueType:"treeSelect",fieldProps:{treeData:i,fieldNames:{key:"id",title:"name"},allowClear:!0}},{title:e["columns.keyword"],dataIndex:"keyword",search:!0,hide:!0},{title:"ID",dataIndex:"id"},{title:e["columns.title"],dataIndex:"title",ellipsis:!0},{title:e["columns.category"],dataIndex:"category"},{title:e["columns.author"],dataIndex:"author"},{title:e["columns.coverImage"],width:150,dataIndex:"cover_image",render:(u,c)=>{if(c.cover_image){let o="";return o=c.cover_image,t(se,{width:40,height:40,src:o})}else return e.notCover}},{title:e["columns.views"],dataIndex:"view_count"},{title:e["columns.publishStatus"],dataIndex:"is_published",render(u,c){return c.is_published===1?t(P,{color:"green",children:e["columns.publishStatus.published"]}):t(P,{color:"red",children:e["columns.publishStatus.unPublished"]})}},{title:e["columns.publishedAt"],width:200,dataIndex:"published_at"},{title:e["columns.action"],width:280,render:(u,c)=>y(oe,{children:[y(C,{type:"text",onClick:()=>w(c.uuid),children:[t(Z,{}),e["columns.action.edit"]]}),c.is_published===0?y(C,{type:"text",onClick:async()=>{(await ee(c.uuid)).code===0&&a.current.reload()},children:[t(fe,{}),e["columns.action.publish"]]}):y(C,{type:"text",onClick:async()=>{(await te(c.uuid)).code===0&&a.current.reload()},children:[t(me,{}),e["columns.action.unPublish"]]}),t(le,{reqDel:re,params:{uuid:c.uuid},reload:()=>a.current.reload(),children:y(C,{type:"text",children:[t(de,{}),e["columns.action.delete"]]})})]})}];return y(F,{children:[p.visible&&t(he,{visible:p.visible,data:p.data,close:()=>p.close(),reload:()=>a.current.reload()}),t(A,{style:{display:p.visible?"none":void 0},children:t(Q,{ref:a,request:ae,columns:I,dataRender:d,actionBarRender:[t(C,{type:"primary",onClick:()=>a.current.reload(),children:r["table.refresh"]},"refresh")],toolBarRender:[t(C,{type:"primary",onClick:()=>{f(u=>{u.visible=!0,u.data=void 0})},children:r["table.createArticle"]},"create")]})})]})}export{Re as default};
