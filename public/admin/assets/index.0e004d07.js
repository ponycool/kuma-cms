import{h,aj as p,aB as u,r as g,j as e,K as C,B as s,a as f,aC as _,u as x,i as b,bc as I,F as y}from"./index.6baa9237.js";import{U as D}from"./index.fefa5771.js";import{C as B}from"./index.adedcd4b.js";import{D as E,P as v}from"./index.ba639177.js";import{i as w,C as j,D as L}from"./use-immer.module.1f7d219c.js";import"./index.1ec5f8a4.js";import{c as F}from"./convertNullToUndefined.a19d8223.js";import{f as A}from"./formatDate.c584a859.js";import{i as k}from"./index.4a144940.js";import{I as T}from"./image.d7a4aff5.js";import{I as q}from"./index.3d88a473.js";import"./index.cd935aea.js";import"./index.72406e2d.js";import"./index.d3eb644a.js";function z(t){return h.post("/api/team/query",t)}function P(t){return h.post("/api/team/detail",t)}function R(t){return h.post("/api/team/create",t)}function S(t){return h.post("/api/team/update",t)}function W(t){return h.post("/api/team/delete",t)}const N=p.TextArea;function U(t){const[a]=u.useForm(),[d,n]=g.exports.useState(!1);async function c(){a.validate().then(async i=>{n(!0);const r=F(i);try{const l={...r,profile_image:r.profile_image&&r.profile_image.length!==0?r.profile_image[0].response.data.name:void 0,sort_index:r.sort_index||1,joined_date:r.joined_date};let o;t.data?o=await S({...l,uuid:t.data.uuid}):o=await R(l),o.code===0&&(t.reload(),t.close())}finally{n(!1)}}).catch(()=>{console.error("\u4FE1\u606F\u4E0D\u5B8C\u6574")})}return g.exports.useEffect(()=>{if(t.data){const i=F(t.data),r=i.profile_image;a.setFieldsValue({...i,profile_image:i.profile_image?[{uid:i.profile_image,url:r,response:{data:{name:i.profile_image.replace("/media/image?n=",""),path:i.profile_image}}}]:[],joined_date:i.joined_date?A(new Date(i.joined_date)):void 0})}},[t.data]),g.exports.useEffect(()=>{t.visible===!1&&a.resetFields()},[a,t.visible]),e(B,{title:t.data?"\u4FEE\u6539\u6210\u5458":"\u521B\u5EFA\u6210\u5458",extra:e(C,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>t.close()}),actions:[e(s,{type:"default",onClick:()=>t.close(),children:"\u53D6\u6D88"},"cancel"),e(s,{type:"primary",loading:d,onClick:c,children:t.data?"\u4FDD\u5B58":"\u521B\u5EFA"},"submit")],children:f(u,{form:a,labelCol:{span:2},wrapperCol:{span:22},children:[e(u.Item,{label:"\u6210\u5458\u540D\u5B57",field:"name",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6210\u5458\u540D\u5B57"}],children:e(p,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u6210\u5458\u540D\u5B57"})}),e(u.Item,{label:"\u6210\u5458\u804C\u4F4D",field:"job_title",children:e(p,{maxLength:100,showWordLimit:!0,placeholder:"\u8BF7\u8F93\u5165\u6210\u5458\u804C\u4F4D"})}),e(u.Item,{label:"\u6210\u5458\u5934\u50CF",field:"profile_image",triggerPropName:"fileList",children:e(D,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),e(u.Item,{label:"\u6210\u5458\u7B80\u4ECB",field:"introduction",children:e(N,{maxLength:200,placeholder:"\u6210\u5458\u7B80\u4ECB",showWordLimit:!0,autoSize:!0,style:{minHeight:64}})}),e(u.Item,{label:"\u6210\u5458\u624B\u673A\u53F7",field:"phone",children:e(p,{maxLength:100,showWordLimit:!0,placeholder:"\u6210\u5458\u624B\u673A\u53F7"})}),e(u.Item,{label:"\u6210\u5458\u90AE\u7BB1",field:"email",rules:[{validator(i,r){i&&!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(i)&&r("\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E")}}],children:e(p,{maxLength:100,showWordLimit:!0,placeholder:"\u6210\u5458\u90AE\u7BB1"})}),e(u.Item,{label:"\u5165\u804C\u65F6\u95F4",field:"joined_date",wrapperCol:{span:2},children:e(E,{})}),e(u.Item,{label:"\u6392\u5E8F",field:"sort_index",wrapperCol:{span:2},initialValue:1,rules:[{validator(i,r){i&&i<1?r("\u6392\u5E8F\u5FC5\u987B\u5927\u4E8E0"):r()}}],children:e(_,{maxLength:10,hideControl:!0,precision:0,placeholder:"\u6392\u5E8F"})})]})})}function ae(){const t=x(b),a=x(k),d=g.exports.useRef(),[n,c]=w({visible:!1,close:function(){c(l=>{l.visible=!1})}});async function i(l){try{const o=await P({uuid:l});o.code===0&&c(m=>{m.data=o.data,m.visible=!0})}catch{}}const r=[{title:a["columns.keyword"],dataIndex:"keyword",search:!0,hide:!0},{title:a["columns.name"],dataIndex:"name",ellipsis:!0},{title:a["columns.avatar"],width:150,dataIndex:"profile_image",render:(l,o)=>{if(o.profile_image){let m="";return m=o.profile_image,e(T,{width:40,height:40,src:m})}else return a["columns.noAvatar"]}},{title:a["columns.position"],dataIndex:"job_title"},{title:a["columns.introduction"],dataIndex:"introduction",ellipsis:!0},{title:a["columns.email"],dataIndex:"email",ellipsis:!0},{title:a["columns.phone"],dataIndex:"phone",ellipsis:!0},{title:a["columns.joinedAt"],dataIndex:"joined_date"},{title:a["columns.action"],width:280,render:(l,o)=>f(j,{children:[f(s,{type:"text",onClick:()=>i(o.uuid),children:[e(I,{}),a["columns.action.edit"]]}),e(L,{reqDel:W,params:{uuid:o.uuid},reload:()=>d.current.reload(),children:f(s,{type:"text",children:[e(q,{}),a["columns.action.delete"]]})})]})}];return f(y,{children:[n.visible&&e(U,{visible:n.visible,data:n.data,close:()=>n.close(),reload:()=>d.current.reload()}),e(B,{style:{display:n.visible?"none":void 0},children:e(v,{ref:d,request:z,columns:r,actionBarRender:[e(s,{type:"primary",onClick:()=>d.current.reload(),children:t["table.refresh"]},"refresh")],toolBarRender:[e(s,{type:"primary",onClick:()=>{c(l=>{l.visible=!0,l.data=void 0})},children:t["table.createMember"]},"create")]})})]})}export{ae as default};
