import{h as y,av as u,R as v,u as E,i as A,r as d,bj as T,j as t,B as g,a as x,F as w,aj as b,K as L,bk as _,M as R,aS as q,ad as M,aR as O,bg as J}from"./index.8958ccd3.js";import{C as N}from"./index.5b407dd2.js";import{A as B,P as j}from"./index.b1730033.js";import{C as W,D as z}from"./DelPopconfirm.59a62120.js";import{D as H}from"./index.9ebfb29d.js";import"./index.8afc8c0f.js";import{c as U}from"./convertNullToUndefined.a19d8223.js";import{f as G}from"./formatDate.c584a859.js";import{T as $}from"./index.c8cf1267.js";import{i as K}from"./use-immer.module.9e5b55d6.js";import{I as V}from"./index.9ef4c395.js";import{I as Z}from"./index.ee4272bb.js";import"./index.9e72e6f1.js";import"./b-tween.es.064e2a03.js";function Q(l){return y.post("/api/leads/query",l)}function X(l){return y.post("/api/leads/detail",l)}function Y(l){return y.post("/api/leads/create",l)}function ee(l){return y.post("/api/leads/update",l)}function ae(l){return y.post("/api/leads/delete",l)}function te(){return y.post("/api/leads/group/query")}function re(){return y.post("/api/leads/status/query")}function le(){return y.post("/api/leads/assigner/query")}const se=u.Item,S=v.createContext({});function oe(l){const{children:e,record:m,className:n,...s}=l,i=d.exports.useRef(null),h=()=>i.current;return t(S.Provider,{value:{getForm:h},children:t(u,{style:{display:"table-row"},children:e,ref:i,wrapper:"tr",wrapperProps:s})})}function ne(l){const{children:e,className:m,rowData:n,column:s,onHandleSave:i}=l,h=E(A),p=d.exports.useRef(null),r=d.exports.useRef(null),{getForm:o}=d.exports.useContext(S),[a,c]=d.exports.useState(!1),f=d.exports.useCallback(C=>{a&&s.editable&&p.current&&!p.current.contains(C.target)&&!C.target.classList.contains("js-demo-select-option")&&F(n[s.dataIndex])},[a,n,s]);d.exports.useEffect(()=>{a&&r.current&&r.current.focus()},[a]),d.exports.useEffect(()=>(document.addEventListener("click",f,!0),()=>{document.removeEventListener("click",f,!0)}),[f]);const F=C=>{o().validate([s.dataIndex],(D,P)=>{(!D||!D[s.dataIndex])&&(c(!a),i&&i({...n,...P}))})};return a?t("div",{ref:p,children:t(se,{style:{marginBottom:0},labelCol:{span:0},wrapperCol:{span:24},initialValue:n[s.dataIndex],field:s.dataIndex,rules:[{required:s.dataIndex==="name",message:s.dataIndex==="name"?h["editableTable.form.name.required"]:void 0}],children:t(b,{ref:r,onPressEnter:F})})}):t("div",{className:s.editable?`editable-cell ${m}`:m,onClick:()=>{s.editable&&c(!a)},children:e||"-"})}function ue(l){const e=E(A),{lang:m}=d.exports.useContext(T),[n,s]=d.exports.useState([]);function i(r){const o=[...n],a=o.findIndex(c=>r.key===c.key);o.splice(a,1,{...o[a],...r}),s(o)}function h(){s([...n].concat({key:Math.random()*1e3,name:"",phone:""}))}const p=v.useMemo(()=>{const r=[...l.columns];return r.some(o=>o.dataIndex==="option")||r.push({title:e["editableTable.delete"],dataIndex:"option",render:(o,a)=>t(g,{onClick:()=>{s(c=>c.filter(f=>f.key!==a.key))},type:"primary",status:"danger",children:e["editableTable.delete"]})}),r},[n,m]);return d.exports.useEffect(()=>{!n.length&&l.data&&l.data.length&&s(l.data.map(r=>({...r,key:r.key?r.key:Math.random()*1e3})))},[l.data]),d.exports.useEffect(()=>{l.onChange(n)},[n]),x(w,{children:[t(g,{style:{marginBottom:10},type:"primary",onClick:h,children:e["editableTable.create"]}),t($,{rowKey:"name",pagination:!1,data:n,components:{body:{row:oe,cell:ne}},columns:p.map(r=>r.editable?{...r,onCell:()=>({onHandleSave:i})}:r)})]})}const k={"en-US":{"columns.companyName":"Company","columns.customerName":"Customer","columns.phone":"Phone","columns.email":"Email","columns.group":"Group","columns.assigned":"Assigned","columns.assignedAt":"AssignedAt","columns.status":"Status","columns.source":"Source","columns.registrationSource":"Registration Source","columns.trafficSource":"Traffic Source","columns.registrationEntry":"Registration Entry","columns.tags":"Tag","columns.allocateTime":"AllocateAt","columns.updatedAt":"UpdateAt","columns.keyword":"Keyword","columns.action":"Action","columns.action.edit":"Edit","columns.action.message":"Message","columns.action.delete":"Delete","leadsCreate.title.create":"Create Leads","leadsCreate.title.update":"Update Leads","leadsCreate.button.cancel":"Cancel","leadsCreate.button.save":"Save","leadsCreate.button.create":"Create","leadsCreate.form.companyName.label":"Company Name","leadsCreate.form.companyName.placeholder":"Please enter the company name","leadsCreate.form.companyName.required":"Please enter the company name","leadsCreate.form.customerName.label":"Customer Name","leadsCreate.form.customerName.placeholder":"Please enter the customer name","leadsCreate.form.customerName.required":"Please enter the customer name","leadsCreate.form.phone.label":"Phone","leadsCreate.form.phone.placeholder":"Please enter the phone","leadsCreate.form.phone.required":"Please enter the phone","leadsCreate.form.phone.error":"Phone format is incorrect","leadsCreate.form.email.label":"Email","leadsCreate.form.email.placeholder":"Please enter the email","leadsCreate.form.email.required":"Please enter the email","leadsCreate.form.email.error":"Email format is incorrect","leadsCreate.form.assigned.label":"Assigned","leadsCreate.form.assigned.placeholder":"Please enter the assigned","leadsCreate.form.assignedAt.label":"AssignedAt","leadsCreate.form.source.label":"Source","leadsCreate.form.source.placeholder":"Please enter the source","leadsCreate.form.tags.label":"Tag","leadsCreate.form.tags.placeholder":"Please enter the tag","leadsCreate.form.registrationEntry.label":"Registration Entry","leadsCreate.form.registrationEntry.placeholder":"Please enter the registration entry","leadsCreate.form.group.label":"Group","leadsCreate.form.group.placeholder":"Please enter the group","leadsCreate.form.status.label":"Status","leadsCreate.form.status.placeholder":"Please enter the status","leadsCreate.form.additionalContacts.label":"Additional Contacts","leadsCreate.form.description.label":"Description","leadsCreate.form.description.placeholder":"Please enter the description"},"zh-CN":{"columns.companyName":"\u516C\u53F8\u540D\u79F0","columns.customerName":"\u5BA2\u6237\u59D3\u540D","columns.phone":"\u624B\u673A","columns.email":"\u90AE\u7BB1","columns.group":"\u5206\u7EC4","columns.assigned":"\u8D1F\u8D23\u4EBA","columns.assignedAt":"\u5206\u914D\u65F6\u95F4","columns.status":"\u72B6\u6001","columns.source":"\u6765\u6E90","columns.registrationSource":"\u6CE8\u518C\u6765\u6E90","columns.trafficSource":"\u6D41\u91CF\u6765\u6E90","columns.registrationEntry":"\u6CE8\u518C\u5165\u53E3","columns.tags":"\u6807\u7B7E","columns.allocateTime":"\u5206\u914D\u65F6\u95F4","columns.updatedAt":"\u521B\u5EFA\u65F6\u95F4","columns.keyword":"\u5173\u952E\u8BCD","columns.action":"\u64CD\u4F5C","columns.action.edit":"\u7F16\u8F91","columns.action.message":"\u6D88\u606F","columns.action.delete":"\u5220\u9664","columns.wechat":"\u5FAE\u4FE1","leadsCreate.title.create":"\u521B\u5EFA\u7EBF\u7D22","leadsCreate.title.update":"\u7F16\u8F91\u7EBF\u7D22","leadsCreate.button.cancel":"\u53D6\u6D88","leadsCreate.button.save":"\u4FDD\u5B58","leadsCreate.button.create":"\u521B\u5EFA","leadsCreate.form.companyName.label":"\u516C\u53F8\u540D\u79F0","leadsCreate.form.companyName.placeholder":"\u8BF7\u8F93\u5165\u516C\u53F8\u540D\u79F0","leadsCreate.form.customerName.label":"\u5BA2\u6237\u59D3\u540D","leadsCreate.form.customerName.placeholder":"\u8BF7\u8F93\u5165\u5BA2\u6237\u59D3\u540D","leadsCreate.form.customerName.required":"\u8BF7\u8F93\u5165\u5BA2\u6237\u59D3\u540D","leadsCreate.form.phone.label":"\u624B\u673A","leadsCreate.form.phone.placeholder":"\u8BF7\u8F93\u5165\u624B\u673A","leadsCreate.form.phone.required":"\u8BF7\u8F93\u5165\u624B\u673A","leadsCreate.form.phone.error":"\u624B\u673A\u683C\u5F0F\u4E0D\u6B63\u786E","leadsCreate.form.email.label":"\u90AE\u7BB1","leadsCreate.form.email.placeholder":"\u8BF7\u8F93\u5165\u90AE\u7BB1","leadsCreate.form.email.required":"\u8BF7\u8F93\u5165\u90AE\u7BB1","leadsCreate.form.email.error":"\u90AE\u7BB1\u683C\u5F0F\u4E0D\u6B63\u786E","leadsCreate.form.assigned.label":"\u8D1F\u8D23\u4EBA","leadsCreate.form.assigned.placeholder":"\u8BF7\u8F93\u5165\u8D1F\u8D23\u4EBA","leadsCreate.form.assignedAt.label":"\u5206\u914D\u65F6\u95F4","leadsCreate.form.source.label":"\u6765\u6E90","leadsCreate.form.source.placeholder":"\u8BF7\u8F93\u5165\u6765\u6E90","leadsCreate.form.tags.label":"\u6807\u7B7E","leadsCreate.form.tags.placeholder":"\u8BF7\u8F93\u5165\u6807\u7B7E","leadsCreate.form.registrationEntry.label":"\u6CE8\u518C\u5165\u53E3","leadsCreate.form.registrationEntry.placeholder":"\u8BF7\u8F93\u5165\u6CE8\u518C\u5165\u53E3","leadsCreate.form.group.label":"\u5206\u7EC4","leadsCreate.form.group.placeholder":"\u8BF7\u8F93\u5165\u5206\u7EC4","leadsCreate.form.status.label":"\u72B6\u6001","leadsCreate.form.status.placeholder":"\u8BF7\u8F93\u5165\u72B6\u6001","leadsCreate.form.additionalContacts.label":"\u9644\u52A0\u8054\u7CFB\u65B9\u5F0F","leadsCreate.form.description.label":"\u5907\u6CE8","leadsCreate.form.description.placeholder":"\u8BF7\u8F93\u5165\u5907\u6CE8"}},de=b.TextArea,{Option:I}=B;function ie(l){var p,r,o;const e=E(k),[m]=u.useForm(),[n,s]=d.exports.useState(!1),i=[{title:e["columns.customerName"],dataIndex:"name",editable:!0},{title:e["columns.phone"],dataIndex:"phone",editable:!0},{title:e["columns.wechat"],dataIndex:"wechat",editable:!0},{title:e["columns.email"],dataIndex:"email",editable:!0}];async function h(){m.validate().then(async a=>{s(!0);try{const c=a.additional_contacts.flatMap(C=>C.name===""?[]:{name:C.name,phone:C.phone,wechat:C.wechat,email:C.email}),f={...a,tags:JSON.stringify(a.tags),additional_contacts:JSON.stringify(c)};let F;l.data?F=await ee({...f,uuid:l.data.uuid}):F=await Y(f),F.code===0&&(l.reload(),l.close())}finally{s(!1)}}).catch(a=>{if(a.errors)for(const c in a.errors)R.error(a.errors[c].message)})}return d.exports.useEffect(()=>{if(l.data){const a=U(l.data);m.setFieldsValue({...a,assigned_at:a.assigned_at?G(new Date(a.assigned_at)):void 0,tags:a.tags&&Array.isArray(JSON.parse(a.tags))?JSON.parse(a.tags):[],additional_contacts:a.additional_contacts&&Array.isArray(JSON.parse(a.additional_contacts))?JSON.parse(a.additional_contacts):[]})}},[l.data]),d.exports.useEffect(()=>{l.visible===!1&&m.resetFields()},[m,l.visible]),t(N,{title:l.data?e["leadsCreate.title.update"]:e["leadsCreate.title.create"],extra:t(L,{style:{cursor:"point",color:"#333",fontSize:"16px"},onClick:()=>l.close()}),actions:[t(g,{type:"default",onClick:()=>l.close(),children:e["leadsCreate.button.cancel"]},"cancel"),t(g,{type:"primary",loading:n,onClick:h,children:l.data?e["leadsCreate.button.save"]:e["leadsCreate.button.create"]},"submit")],children:x(u,{form:m,labelCol:{span:2},wrapperCol:{span:8},children:[t(u.Item,{label:e["leadsCreate.form.companyName.label"],field:"company",children:t(b,{maxLength:100,showWordLimit:!0,placeholder:e["leadsCreate.form.companyName.placeholder"]})}),t(u.Item,{label:e["leadsCreate.form.customerName.label"],field:"name",children:t(b,{maxLength:50,showWordLimit:!0,placeholder:e["leadsCreate.form.customerName.placeholder"]})}),t(u.Item,{label:e["leadsCreate.form.phone.label"],field:"phone",rules:[{validator(a,c){a&&!/^[0-9]{11}$/.test(a)&&c(e["leadsCreate.form.phone.required"])}}],children:t(b,{maxLength:100,showWordLimit:!0,placeholder:e["leadsCreate.form.phone.placeholder"]})}),t(u.Item,{label:e["leadsCreate.form.email.label"],field:"email",rules:[{validator(a,c){a&&!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(a)&&c(e["leadsCreate.form.email.error"])}}],children:t(b,{maxLength:50,showWordLimit:!0,placeholder:e["leadsCreate.form.email.placeholder"]})}),t(u.Item,{label:e["leadsCreate.form.assigned.label"],field:"assigned_to",children:t(B,{placeholder:e["leadsCreate.form.assigned.placeholder"],children:(p=l.assigner)==null?void 0:p.map(a=>t(I,{value:a,children:a},a))})}),t(u.Item,{label:e["leadsCreate.form.assignedAt.label"],field:"assigned_at",disabled:!0,wrapperCol:{span:2},children:t(H,{})}),t(u.Item,{label:e["leadsCreate.form.source.label"],field:"source",disabled:!0,children:t(b,{maxLength:100,showWordLimit:!0,placeholder:e["leadsCreate.form.source.placeholder"]})}),t(u.Item,{label:e["leadsCreate.form.tags.label"],field:"tags",children:t(_,{allowClear:!0,placeholder:e["leadsCreate.form.tags.placeholder"]})}),t(u.Item,{label:e["leadsCreate.form.registrationEntry.label"],field:"registration_entry",disabled:!0,children:t(b,{maxLength:100,showWordLimit:!0,placeholder:e["leadsCreate.form.registrationEntry.placeholder"]})}),t(u.Item,{label:e["leadsCreate.form.group.label"],field:"group",wrapperCol:{span:2},children:t(B,{placeholder:e["leadsCreate.form.group.placeholder"],children:(r=l.group)==null?void 0:r.map(a=>t(I,{value:a,children:a},a))})}),t(u.Item,{label:e["leadsCreate.form.status.label"],field:"status",wrapperCol:{span:2},children:t(B,{placeholder:e["leadsCreate.form.status.placeholder"],children:(o=l.status)==null?void 0:o.map(a=>t(I,{value:a,children:a},a))})}),t(u.Item,{label:e["leadsCreate.form.additionalContacts.label"],field:"additional_contacts",triggerPropName:"data",wrapperCol:{span:22},children:t(ue,{columns:i})}),t(u.Item,{label:e["leadsCreate.form.description.label"],field:"description",wrapperCol:{span:22},children:t(de,{maxLength:200,placeholder:e["leadsCreate.form.description.placeholder"],showWordLimit:!0,autoSize:!0,style:{minHeight:100}})})]})})}function De(){const l=E(A),e=E(k),m=q(),n=d.exports.useRef(),[s,i]=K({visible:!1,close:function(){i(r=>{r.visible=!1})},group:[],status:[],assigner:[]});d.exports.useEffect(()=>{s.visible||(te().then(r=>{r.code===0&&i(o=>{o.group=r.data||[]})}),re().then(r=>{r.code===0&&i(o=>{o.status=r.data||[]})}),le().then(r=>{r.code===0&&i(o=>{o.assigner=r.data||[]})}))},[s.visible]);async function h(r){try{const o=await X({uuid:r});o.code===0&&i(a=>{a.data=o.data,a.visible=!0})}catch{}}const p=[{title:"ID",width:80,dataIndex:"id",sorter:!0},{title:e["columns.companyName"],dataIndex:"company",ellipsis:!0,sorter:!0,width:200,search:!0},{title:e["columns.customerName"],dataIndex:"name",sorter:!0,ellipsis:!0,width:150,copy:!0},{title:e["columns.phone"],dataIndex:"phone",sorter:!0,copy:!0},{title:e["columns.email"],width:200,dataIndex:"email",sorter:!0,ellipsis:!0,copy:!0},{title:e["columns.group"],dataIndex:"group",sorter:!0,search:!0,valueType:"autoComplete",fieldProps:{data:s.group}},{title:e["columns.assigned"],dataIndex:"assigned_to",sorter:!0,search:!0,valueType:"autoComplete",fieldProps:{data:s.assigner}},{title:e["columns.assignedAt"],dataIndex:"assigned_at",sorter:!0},{title:e["columns.status"],dataIndex:"status",sorter:!0,search:!0,valueType:"select",fieldProps:{options:s.status.map(r=>({label:r,value:r}))}},{title:e["columns.registrationSource"],dataIndex:"registration_source",sorter:!0,search:!0},{title:e["columns.trafficSource"],dataIndex:"traffic_source",sorter:!0,search:!0},{title:e["columns.registrationEntry"],dataIndex:"registration_entry",sorter:!0,search:!0},{title:e["columns.tags"],dataIndex:"tags",render(r,o){if(o.tags&&typeof JSON.parse(o.tags)=="object")return t(M,{children:JSON.parse(o.tags).map(a=>t(O,{children:a},a))})}},{title:e["columns.allocateTime"],dataIndex:"assignedStartTime,assignedEndTime",search:!0,valueType:"date",hide:!0},{title:e["columns.updatedAt"],width:200,dataIndex:"updated_at",sorter:!0},{title:e["columns.updatedAt"],dataIndex:"startTime,endTime",search:!0,valueType:"date",hide:!0},{title:e["columns.keyword"],dataIndex:"keyword",search:!0,hide:!0},{title:e["columns.action"],width:280,fixed:"right",render:(r,o)=>x(W,{children:[x(g,{type:"text",onClick:()=>h(o.uuid),children:[t(J,{}),e["columns.action.edit"]]}),x(g,{type:"text",onClick:()=>{m.push({pathname:"/marketManage/message",search:new URLSearchParams({name:o.name,phone:o.phone,email:o.email}).toString()})},children:[t(V,{}),e["columns.action.message"]]}),t(z,{reqDel:ae,params:{uuid:o.uuid},reload:()=>n.current.reload(),children:x(g,{type:"text",children:[t(Z,{}),e["columns.action.delete"]]})})]})}];return x(w,{children:[s.visible&&t(ie,{visible:s.visible,data:s.data,close:()=>s.close(),reload:()=>n.current.reload(),group:s.group,status:s.status,assigner:s.assigner}),t(N,{style:{display:s.visible?"none":void 0},children:t(j,{ref:n,request:Q,columns:p,scroll:{x:2500},actionBarRender:[t(g,{type:"primary",onClick:()=>n.current.reload(),children:l["table.refresh"]},"refresh")],toolBarRender:[t(g,{type:"primary",onClick:()=>{i(r=>{r.visible=!0,r.data=void 0})},children:l["table.createClue"]},"create")]})})]})}export{De as default};
