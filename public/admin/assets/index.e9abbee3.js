import{h as m,u as T,av as o,r as p,j as a,bd as j,a as h,aj as I,af as F,aw as N,am as B,bl as P,i as R,B as g,bc as W,l as $,bm as z,be as G}from"./index.5a0c33df.js";import{U as H}from"./index.8ebdba9b.js";import{C as J}from"./index.5f2388e4.js";import{T as K,P as Q}from"./index.470657a8.js";import{C as X,D as Y}from"./DelPopconfirm.30598354.js";import"./index.562f16f6.js";import{t as Z}from"./index.a8ca232a.js";import{c as x}from"./convertNullToUndefined.a19d8223.js";import{q as ee}from"./index.20b22abb.js";import{i as ue}from"./use-immer.module.4fac396b.js";import{I as te}from"./image.b9ea4c32.js";import{I as ae}from"./index.5b7bcfd2.js";import{I as ie}from"./index.2f970919.js";import{I as le}from"./index.3a2954fc.js";import"./index.96d3565b.js";import"./index.5575f737.js";import"./index.ee0743d5.js";import"./index.0c94fae9.js";import"./b-tween.es.064e2a03.js";import"./index.80aaa462.js";import"./index.acb494f1.js";import"./index.e265e6bf.js";function ne(t){return m.post("/api/menu/query",t)}function re(t){return m.post("/api/menu/delete",t)}function se(t){return m.post("/api/menu/create",t)}function de(t){return m.post("/api/menu/update",t)}function oe(t){return m.post("/api/menu/enable",t)}function ce(t){return m.post("/api/menu/disable",t)}function D(){return m.post("/api/menu/type/query")}function pe(){return m.post("/api/link/type/query")}function me(){return m.post("/api/module/query")}function he(t){return m.post("/api/menu/visible",t)}function ge(t){return m.post("/api/menu/hidden",t)}const L={"en-US":{create:"Create",update:"Update",cancel:"Cancel",save:"Save",parentMenu:"Parent Menu","parentMenu.required":"Parent menu is required","parentMenu.error":"Parent menu cannot be itself","parentMenu.placeholder":"Please enter a parent Menu",name:"Menu Name","name.placeholder":"Please enter a menu name","name.required":"Please enter a menu name",code:"Menu Code","code.placeholder":"Please enter a menu code","code.required":"Please enter a menu code",icon:"Menu Icon",noIcon:"No Icon",menuType:"Menu Type","menuType.placeholder":"Please select a menu type","menuType.required":"Please select a menu type",linkType:"Link Type","linkType.placeholder":"Please select a link type","linkType.required":"Please select a link type",linkUrl:"Link URL","linkUrl.placeholder":"Please enter a link URL","linkUrl.required":"Please enter a link URL",singlePage:"Single Page","singlePage.placeholder":"Please select a single page","singlePage.required":"Please select a single page",module:"Module","module.placeholder":"Please select a module","module.required":"Please select a module",target:"Target","target.placeholder":"Please select a target","target.required":"Please select a target",sortIndex:"Sort Index",isVisible:"Is Visible",isEnable:"Is Enable",action:"Action",edit:"Edit",visible:"Visible",hidden:"Hidden",enable:"Enable",disable:"Disable",delete:"Delete"},"zh-CN":{create:"\u521B\u5EFA",update:"\u66F4\u65B0",cancel:"\u53D6\u6D88",save:"\u4FDD\u5B58",parentMenu:"\u7236\u7EA7\u83DC\u5355","parentMenu.required":"\u7236\u7EA7\u83DC\u5355\u4E0D\u80FD\u4E3A\u7A7A","parentMenu.error":"\u7236\u7EA7\u83DC\u5355\u4E0D\u80FD\u9009\u62E9\u81EA\u5DF1","parentMenu.placeholder":"\u8BF7\u9009\u62E9\u7236\u7EA7\u83DC\u5355",name:"\u540D\u79F0","name.required":"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0","name.placeholder":"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0",code:"\u83DC\u5355\u7F16\u7801","code.required":"\u8BF7\u8F93\u5165\u83DC\u5355\u7F16\u7801","code.placeholder":"\u8BF7\u8F93\u5165\u83DC\u5355\u7F16\u7801",icon:"\u83DC\u5355\u56FE\u6807",noIcon:"\u6682\u65E0\u56FE\u6807",menuType:"\u83DC\u5355\u7C7B\u578B","menuType.placeholder":"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B","menuType.required":"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B",linkType:"\u94FE\u63A5\u7C7B\u578B","linkType.placeholder":"\u8BF7\u9009\u62E9\u94FE\u63A5\u7C7B\u578B","linkType.required":"\u8BF7\u9009\u62E9\u94FE\u63A5\u7C7B\u578B",linkUrl:"\u94FE\u63A5\u5730\u5740","linkUrl.placeholder":"\u8BF7\u8F93\u5165\u94FE\u63A5\u5730\u5740","linkUrl.required":"\u8BF7\u8F93\u5165\u94FE\u63A5\u5730\u5740",singlePage:"\u5355\u9875","singlePage.placeholder":"\u8BF7\u9009\u62E9\u5355\u9875","singlePage.required":"\u8BF7\u9009\u62E9\u5355\u9875",module:"\u6A21\u5757","module.placeholder":"\u8BF7\u9009\u62E9\u6A21\u5757","module.required":"\u8BF7\u9009\u62E9\u6A21\u5757",target:"\u8DF3\u8F6C\u65B9\u5F0F","target.placeholder":"\u8BF7\u9009\u62E9\u8DF3\u8F6C\u65B9\u5F0F","target.required":"\u8BF7\u9009\u62E9\u8DF3\u8F6C\u65B9\u5F0F",sortIndex:"\u6392\u5E8F",isVisible:"\u663E\u793A",isEnable:"\u542F\u7528",action:"\u64CD\u4F5C",edit:"\u7F16\u8F91",visible:"\u663E\u793A",hidden:"\u9690\u85CF",enable:"\u542F\u7528",disable:"\u7981\u7528",delete:"\u5220\u9664"}};function be(t){const u=T(L),[s]=o.useForm(),[y,k]=p.exports.useState(!1),[b,f]=p.exports.useState([]),[E,v]=p.exports.useState([]),[r,l]=p.exports.useState([]),[i,d]=p.exports.useState(""),[C,M]=p.exports.useState([]),[A,w]=p.exports.useState([]),[S,U]=p.exports.useState([{name:"\u6839\u83DC\u5355",id:-1,children:[]}]);async function V(){console.log(s.getFieldsValue()),s.validate().then(async e=>{const n=x({...e,pid:e.pid===-1?0:e.pid,level:e.pid===-1?1:e.pid+1,icon:e.icon&&e.icon.length!==0?e.icon[0].response.data.name:void 0,enabled:!!e.enabled,visible:!!e.visible});try{let c;t.data?c=await de(P({...n,uuid:t.data.uuid})):c=await se(P({...n})),c.code===0&&(t.reload(),t.close())}finally{k(!1)}}).catch(e=>{console.log(e),console.error("\u4FE1\u606F\u4E0D\u5B8C\u6574")})}return p.exports.useEffect(()=>{if(t.pid&&s.setFieldsValue({pid:t.pid===0?-1:t.pid}),t.data){const e=x(t.data),n=e.icon;s.setFieldsValue({...e,pid:e.pid===0?-1:e.pid,icon:e.icon?[{uid:e.icon,url:n,response:{data:{name:e.icon.replace("/media/image?n=",""),path:e.icon}}}]:[],visible:!!e.visible,enabled:!!e.enabled}),d(e.type)}},[t.data,t.pid]),p.exports.useEffect(()=>{if(t.visible===!1&&(d(""),s.resetFields()),t.visible&&t.getList){console.log(t.getList());const e=t.getList(),n=c=>c.map(({name:O,id:_,children:q})=>({name:O,id:_,...q&&q.length?{children:n(q)}:{}}));U([{name:"\u6839\u83DC\u5355",id:-1,children:n(e)}])}},[s,t.visible]),p.exports.useEffect(()=>{D().then(e=>{const n=[];Object.keys(e.data).forEach(c=>{n.push({value:c,label:e.data[c]})}),f(n)}),Z().then(e=>{const n=[];Object.keys(e.data).forEach(c=>{n.push({value:c,label:e.data[c]})}),v(n)}),pe().then(e=>{const n=[];Object.keys(e.data).forEach(c=>{n.push({value:e.data[c],label:c})}),l(n)}),ee({isPage:!1}).then(e=>{M(e.data)}),me().then(e=>{w(e.data)})},[]),a(j,{width:600,title:t.data?u.update:u.create,visible:t.visible,onOk:V,onCancel:t.close,confirmLoading:y,okText:t.data?u.save:u.create,children:h(o,{form:s,labelCol:{span:6},wrapperCol:{span:18},onChange:e=>{console.log(e)},children:[a(o.Item,{label:u.parentMenu,field:"pid",rules:[{required:!0,message:u["parentMenu.required"]},{validator(e,n){t.data&&e===t.data.id&&n(u["parentMenu.error"]),n()}}],initialValue:-1,disabled:!!t.pid,children:a(K,{treeData:S,fieldNames:{key:"id",title:"name"},placeholder:u["parentMenu.placeholder"],onChange:(e,n)=>{Object.keys(n).length===0?s.setFieldValue("pid",-1):s.setFieldValue("pid",n.trigger.dataRef.id)}})}),a(o.Item,{label:u.name,field:"name",rules:[{required:!0,message:u["name.required"]}],children:a(I,{maxLength:100,showWordLimit:!0,placeholder:u["name.placeholder"]})}),a(o.Item,{label:u.code,field:"code",children:a(I,{maxLength:20,showWordLimit:!0,placeholder:u["code.placeholder"]})}),a(o.Item,{label:u.icon,field:"icon",triggerPropName:"fileList",children:a(H,{action:"/api/upload/image",data:{token:JSON.parse(localStorage.getItem("token")).token},imagePreview:!0,accept:"image/png, image/jpg, image/jpeg",listType:"picture-card",limit:1})}),a(o.Item,{label:u.menuType,field:"type",rules:[{required:!0,message:u["menuType.required"]}],children:a(F,{options:b,placeholder:u["menuType.placeholder"],onChange:d})}),i==="link"&&a(o.Item,{label:u.linkType,field:"link_type",rules:[{required:!0,message:u["linkType.required"]}],initialValue:0,children:a(F,{options:r})}),i==="link"&&a(o.Item,{label:u.linkUrl,field:"link_url",rules:[{required:!0,message:u["linkUrl.required"]}],children:a(I,{maxLength:100,showWordLimit:!0,placeholder:u["linkUrl.placeholder"]})}),i==="single_page"&&a(o.Item,{label:u.singlePage,field:"single_page_id",rules:[{required:!0,message:u["singlePage.required"]}],children:a(F,{showSearch:!0,filterOption:(e,n)=>(console.log(e,n),n.props.children.toLowerCase().includes(e.toLowerCase())),options:C.map(e=>({label:e.title,value:e.id})),placeholder:u["singlePage.placeholder"]})}),i==="module"&&a(o.Item,{label:u.module,field:"link_url",rules:[{required:!0,message:u["module.required"]}],children:a(F,{options:A.map(e=>({label:e.text,value:e.link})),placeholder:u["module.placeholder"]})}),a(o.Item,{label:u.target,field:"target",rules:[{required:!0,message:u["target.required"]}],initialValue:"_blank",children:a(F,{options:E,placeholder:u["target.placeholder"]})}),a(o.Item,{label:u.sortIndex,field:"sort_index",initialValue:1,children:a(N,{min:1,step:1,precision:0})}),a(o.Item,{label:u.isVisible,field:"visible",triggerPropName:"checked",initialValue:!1,children:a(B,{})}),a(o.Item,{label:u.isEnable,field:"enabled",triggerPropName:"checked",initialValue:!1,children:a(B,{})})]})})}function _e(){const t=T(R),u=T(L),s=p.exports.useRef(),[y,k]=p.exports.useState(),[b,f]=ue({visible:!1,close:()=>{f(r=>{r.visible=!1,r.data=void 0,r.pid=void 0})}}),E=[{title:"ID",dataIndex:"id"},{title:u.name,dataIndex:"name"},{title:u.code,dataIndex:"code"},{title:u.menuType,render(r,l){return y&&y[l.type]}},{title:u.icon,width:150,render:(r,l)=>{if(l.icon){let i="";return i=l.icon,a(te,{width:40,height:40,src:i})}else return u.noIcon}},{title:u.action,key:"option",render:(r,l)=>h(X,{children:[h(g,{type:"text",onClick:()=>{f(i=>{i.visible=!0,i.pid=l.id})},children:[a(ae,{}),u.create]}),h(g,{type:"text",onClick:()=>{f(i=>{i.visible=!0,i.data=l})},children:[a(W,{}),u.edit]}),h(g,{type:"text",onClick:async()=>{var d;let i;l.visible?i=await(i=ge({uuid:l.uuid})):i=await(i=he({uuid:l.uuid})),i.code===0&&((d=s.current)==null||d.reload())},children:[l.visible?a($,{}):a(z,{}),l.visible?u.visible:u.hidden]}),h(g,{type:"text",onClick:async()=>{var d;let i;l.enabled?i=i=await ce({uuid:l.uuid}):i=i=await oe({uuid:l.uuid}),i.code===0&&((d=s.current)==null||d.reload())},children:[l.enabled?a(G,{}):a(ie,{}),l.enabled?u.enable:u.disable]}),a(Y,{reqDel:re,params:{uuid:l.uuid},reload:()=>s.current.reload(),children:h(g,{type:"text",children:[a(le,{}),u.delete]})})]})}];function v(r){const l=new Map,i=[];return r.forEach(d=>l.set(d.id,{...d,children:[]})),r.forEach(d=>{const C=l.get(d.pid);C?C.children.push(l.get(d.id)):i.push(l.get(d.id))}),i}return p.exports.useEffect(()=>{D().then(r=>{k(r.data)})},[]),h(J,{children:[a(be,{pid:b.pid,data:b.data,visible:b.visible,close:b.close,reload:()=>{var r;return(r=s.current)==null?void 0:r.reload()},getList:()=>{var r;return(r=s.current)==null?void 0:r.getList()}}),a(Q,{ref:s,request:ne,dataRender:v,columns:E,pagination:!1,pageSize:!1,actionBarRender:[a(g,{type:"primary",onClick:()=>{var r;return(r=s.current)==null?void 0:r.reload()},children:t["table.refresh"]},"refresh")],toolBarRender:[a(g,{type:"primary",onClick:()=>{f(r=>{r.visible=!0})},children:t["table.create"]},"create")]})]})}export{_e as default};
