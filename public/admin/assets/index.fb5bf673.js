import{av as m,r as c,j as i,b4 as I,a as v,aj as y,aw as E,az as B,M as w,u as F,i as k,B as C,b3 as R}from"./index.cbcfa651.js";import{C as L}from"./index.a4be1060.js";import{T as M,P as O}from"./index.7e2035b9.js";import{c as S,a as V,i as j,b as q,d as A}from"./index.23bbafce.js";import{C as T,D as G}from"./DelPopconfirm.01b5774a.js";import{i as D}from"./use-immer.module.1ff160c6.js";import{I as _}from"./index.f92d8c2b.js";import{I as z}from"./index.262a5926.js";import"./index.b9274156.js";import"./index.835063de.js";import"./b-tween.es.064e2a03.js";import"./index.9319c329.js";import"./index.63f985ea.js";import"./index.0bb703c6.js";const{Row:N,Col:g}=B;function P(e){const[l]=m.useForm(),[d,o]=c.exports.useState(!1),[u,p]=c.exports.useState(1);c.exports.useEffect(()=>(e.level&&p(e.level+1),()=>{p(1)}),[e.level]),c.exports.useEffect(()=>{e.data?(l.setFieldsValue(e.data),l.setFieldValue("pid",e.data.pid)):e.id&&l.setFieldValue("pid",e.id),e.visible||l.resetFields()},[l,e.data,e.visible]);async function h(){l.validate().then(async t=>{var b;o(!0);let a;e.uuid?a=await S({...t,uuid:e.uuid,pid:t.pid,level:u,sortIndex:t.sortIndex||1}):a=await V({...t,sortIndex:t.sortIndex||1,pid:(b=t.pid)!=null?b:0,level:u}),a.code===0&&(w.success(a.message),e.reload(),e.close(),l.resetFields())}).catch(t=>{console.log(t)}).finally(()=>{o(!1)})}return i(I,{width:400,title:e.uuid?"\u66F4\u65B0\u5206\u7C7B":"\u521B\u5EFA\u5206\u7C7B",visible:e.visible,onOk:h,onCancel:e.close,confirmLoading:d,okText:e.uuid?"\u4FDD\u5B58":"\u521B\u5EFA",children:i(m,{form:l,children:v(N,{children:[i(g,{span:24,children:i(m.Item,{label:"\u5206\u7C7B\u540D\u79F0",field:"name",rules:[{required:!0,message:!0}],labelCol:{span:6},wrapperCol:{span:18},children:i(y,{type:"text"})})}),i(g,{span:24,children:i(m.Item,{label:"\u7236\u7EA7\u5206\u7C7B",field:"pid",labelCol:{span:6},wrapperCol:{span:18},rules:[{validator(t,a){e.data&&t===e.data.id&&a("\u4E0D\u53EF\u9009\u62E9\u5F53\u524D\u5206\u7C7B!"),a()}}],children:i(M,{treeData:e.pidOptions,fieldNames:{key:"id",title:"name"},placeholder:"\u6839\u7EA7",onChange:(t,a)=>{Object.keys(a).length===0?(p(1),l.setFieldValue("pid",0)):(p(a.trigger.dataRef.level+1),l.setFieldValue("pid",a.trigger.dataRef.id))},allowClear:!0})})}),i(g,{span:24,children:i(m.Item,{label:"\u5206\u7C7B\u7F16\u7801",field:"code",labelCol:{span:6},wrapperCol:{span:18},children:i(y,{type:"text"})})}),i(g,{span:24,children:i(m.Item,{label:"\u6392\u5E8F",field:"sortIndex",labelCol:{span:6},wrapperCol:{span:18},initialValue:1,rules:[{validator(t,a){t&&t<1?a("\u6392\u5E8F\u5FC5\u987B\u5927\u4E8E0"):a()}}],children:i(E,{})})})]})})})}function ae(){const e=F(k),l=F(j),d=c.exports.useRef(),[o,u]=D({visible:!1,close:()=>{u(s=>{s.visible=!1})}}),[p,h]=c.exports.useState(),[t]=D({reqDel:q});function a(s){const r=new Map,n=[];return s.forEach(f=>r.set(f.id,{...f,children:[]})),s.forEach(f=>{const x=r.get(f.pid);x?x.children.push(r.get(f.id)):n.push(r.get(f.id))}),n}c.exports.useEffect(()=>{u(s=>{s.pidOptions=d.current.getList()})},[d.current]);const b=[{title:l["columns.name"],dataIndex:"name"},{title:l["columns.action"],key:"option",render:(s,r)=>v(T,{children:[v(C,{type:"text",onClick:()=>{u(n=>{n.id=r.id,n.level=r.level,n.uuid=void 0,n.visible=!0}),h(void 0)},children:[i(_,{}),l["columns.action.create"]]}),v(C,{type:"text",onClick:()=>{u(n=>{n.id=void 0,n.level=void 0,n.uuid=r.uuid,n.visible=!0}),h({name:r.name,code:r.code,sortIndex:r.sort_index,pid:r.pid,id:r.id})},children:[i(R,{}),l["columns.action.edit"]]}),i(G,{reqDel:t.reqDel,params:{uuid:r.uuid},reload:()=>d.current.reload(),children:v(C,{type:"text",children:[i(z,{}),l["columns.action.delete"]]})})]})}];return v(L,{children:[i(P,{data:p,visible:o.visible,id:o.id,level:o.level,uuid:o.uuid,close:o.close,reload:()=>d.current.reload(),pidOptions:o.pidOptions}),i(O,{ref:d,request:A,dataRender:a,columns:b,pagination:!1,pageSize:!1,actionBarRender:[i(C,{type:"primary",onClick:()=>d.current.reload(),children:e["table.refresh"]},"refresh")],toolBarRender:[i(C,{type:"primary",onClick:()=>{u(s=>{s.id=void 0,s.visible=!0,s.uuid=void 0,s.level=void 0}),h(void 0)},children:e["table.createCategory"]},"create")]})]})}export{ae as default};
